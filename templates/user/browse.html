<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Last Plate | Premium Food Rescue</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #030508; --card: rgba(18, 22, 30, 0.7); --text: #ffffff;
      --muted: #8e99a8; --accent: #2ecc71; --accent-glow: rgba(46, 204, 113, 0.3);
      --border: rgba(255, 255, 255, 0.07); --spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --overlay: rgba(0, 0, 0, 0.85); --drawer-bg: #0a0c10;
    }

    body.light {
      --bg: #f8fafc; --card: rgba(255, 255, 255, 0.9); --text: #0f172a;
      --muted: #64748b; --border: rgba(0, 0, 0, 0.08); --drawer-bg: #ffffff;
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    body { 
      margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; 
      background: var(--bg); color: var(--text); 
      transition: background 0.5s ease; overflow-x: hidden; 
    }

    /* --- ANIMATIONS --- */
    @keyframes slideUpFade {
      from { opacity: 0; transform: translateY(40px) scale(0.95); filter: blur(10px); }
      to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }
    @keyframes modalPop {
      0% { opacity: 0; transform: scale(0.8) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* --- LAYOUT --- */
    .navbar {
      position: fixed; top: 0; left: 0; right: 0; height: 80px;
      display: flex; justify-content: space-between; align-items: center;
      padding: 0 6%; background: rgba(var(--bg), 0.7);
      backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 1000;
    }

    .profile-trigger {
      width: 44px; height: 44px; border-radius: 14px; background: var(--card);
      border: 1px solid var(--border); color: var(--text); cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: 0.4s var(--spring);
    }

    .hero { padding: 160px 20px 60px; text-align: center; }
    .hero h1 { font-size: clamp(40px, 10vw, 80px); font-weight: 800; letter-spacing: -4px; margin: 0; }

    .container {
      max-width: 1400px; margin: 0 auto; padding: 0 30px 100px;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 35px;
    }

    /* --- FOOD CARD --- */
    .food-card {
      background: var(--card); border-radius: 35px; border: 1px solid var(--border);
      overflow: hidden; position: relative; backdrop-filter: blur(15px);
      transition: all 0.6s var(--spring); cursor: pointer;
      animation: slideUpFade 0.8s var(--spring) both;
    }
    .food-card:hover {
      transform: translateY(-15px) scale(1.03); border-color: var(--accent);
      box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 20px var(--accent-glow);
    }
    .img-wrapper { position: relative; width: 100%; height: 240px; overflow: hidden; }
    .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 1s ease; }
    .food-card:hover .card-img { transform: scale(1.15); }

    .badge-urgent {
      position: absolute; top: 20px; right: 20px;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(10px);
      padding: 8px 16px; border-radius: 14px;
      font-size: 11px; font-weight: 800; color: var(--accent); border: 1px solid var(--accent);
    }

    .price-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);
    }
    .price-main { font-size: 28px; font-weight: 800; color: var(--accent); }

    /* --- PROFILE DRAWER --- */
    .drawer-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4); 
      display: none; justify-content: flex-end; z-index: 2000; backdrop-filter: blur(4px);
    }
    .drawer-overlay.active { display: flex; }
    .drawer {
      width: 100%; max-width: 400px; background: var(--drawer-bg); height: 100%;
      padding: 40px; border-left: 1px solid var(--border);
      transform: translateX(100%); transition: 0.5s var(--spring);
    }
    .drawer-overlay.active .drawer { transform: translateX(0); }

    /* --- MODAL --- */
    .modal-overlay {
      position: fixed; inset: 0; background: var(--overlay);
      backdrop-filter: blur(15px); z-index: 3000;
      display: none; justify-content: center; align-items: center; padding: 20px;
    }
    .modal-overlay.active { display: flex; }
    .modal-card {
      background: var(--bg); width: 100%; max-width: 550px;
      border-radius: 40px; border: 1px solid var(--border);
      overflow: hidden; animation: modalPop 0.5s var(--spring) forwards;
    }
    .modal-banner { height: 260px; background-size: cover; background-position: center; position: relative; }

    .reserve-now {
      display: block; width: 100%; padding: 20px; background: var(--accent);
      color: #000; text-align: center; border-radius: 20px;
      font-weight: 800; text-decoration: none; margin-top: 30px;
    }
  </style>
</head>
<body>

<nav class="navbar">
  <div style="font-weight:900; font-size:24px; letter-spacing:-1.5px;">LAST PLATE</div>
  <button class="profile-trigger" id="openProfile">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
  </button>
</nav>

<header class="hero">
  <h1>Rescuing <span style="color:var(--accent)">Flavors.</span></h1>
  <p style="color:var(--muted);">Kerala's finest rescues: Biryani, Alfahm & more.</p>
</header>

<main class="container" id="foodGrid">
  <div style="color:var(--muted)">Connecting to kitchen...</div>
</main>

<div class="drawer-overlay" id="profileOverlay">
  <div class="drawer">
    <button id="closeProfile" style="background:none; border:none; color:var(--accent); cursor:pointer; font-weight:800; margin-bottom:30px;">← CLOSE</button>
    <h2 style="font-size: 32px; letter-spacing: -1px; margin-bottom: 30px;">Settings</h2>
    
    <div style="background:var(--card); padding:25px; border-radius:24px; border:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
      <span style="font-weight:700">Light Mode</span>
      <input type="checkbox" id="themeToggle" style="width:22px; height:22px; cursor:pointer;">
    </div>

    <div style="margin-top:40px;">
      <h3 style="color:var(--muted); font-size:14px; text-transform:uppercase;">Account</h3>
      <p id="p-name" style="font-size:20px; font-weight:700;">Gourmet Explorer</p>
    </div>

    <button onclick="location.href='/logout'" style="width:100%; margin-top:60px; padding:20px; border-radius:20px; background:#ff4757; color:white; font-weight:800; border:none; cursor:pointer;">Sign Out</button>
  </div>
</div>

<div class="modal-overlay" id="foodModal">
  <div class="modal-card">
    <div class="modal-banner" id="m-banner">
      <button onclick="closeModal()" style="position:absolute; top:20px; right:20px; background:rgba(0,0,0,0.5); border:none; color:white; border-radius:50%; width:40px; height:40px; cursor:pointer;">×</button>
    </div>
    <div class="modal-body" style="padding:40px;">
      <div id="m-kitchen" style="color:var(--muted); font-size:12px; font-weight:700; text-transform:uppercase;"></div>
      <h2 id="m-title" style="font-size:32px; margin:10px 0;"></h2>
      <p id="m-desc" style="color:var(--muted); line-height:1.6;"></p>
      <div class="price-row">
        <div id="m-price" class="price-main"></div>
        <div id="m-left" style="font-weight:800; color:var(--accent)"></div>
      </div>
      <a href="#" id="m-link" class="reserve-now">Reserve Now</a>
    </div>
  </div>
</div>

<script>
  let allFoods = [];

  // --- THEMED IMAGE ENGINE (Your Specific Requests) ---
  function getImg(name) {
    const n = name.toLowerCase();
    const lib = {
      biryani: 'https://images.unsplash.com/photo-1563379091339-03b21bc4a4f8?q=80&w=800',
      alfahm: 'https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?q=80&w=800',
      butterchicken: 'https://images.unsplash.com/photo-1603894584114-f061d7379b8a?q=80&w=800',
      porotta: 'https://images.unsplash.com/photo-1626132646529-500637532537?q=80&w=800',
      chappati: 'https://images.unsplash.com/photo-1589113744339-847361869f80?q=80&w=800',
      burger: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=800',
      pizza: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800'
    };
    
    if (n.includes('biryani')) return lib.biryani;
    if (n.includes('alfahm') || n.includes('grilled')) return lib.alfahm;
    if (n.includes('butter') || n.includes('curry')) return lib.butterchicken;
    if (n.includes('porotta') || n.includes('paratha')) return lib.porotta;
    if (n.includes('chappati') || n.includes('roti')) return lib.chappati;
    
    return lib.burger; // Default
  }

  // --- DB SYNC ---
  async function init() {
    try {
      const res = await fetch("/api/foods");
      const data = await res.json();
      allFoods = data.foods || [];
      render(allFoods);
    } catch (e) {
      console.error("DB Error", e);
    }
  }

  function render(items) {
    const grid = document.getElementById('foodGrid');
    grid.innerHTML = items.map((f, i) => `
      <div class="food-card" style="animation-delay: ${i * 0.1}s" onclick="openModal(${f.id})">
        <div class="img-wrapper">
          <img src="${f.image_url || getImg(f.name)}" class="card-img">
          <div class="badge-urgent">⚡ ${f.minutes_left || 'Few'}M LEFT</div>
        </div>
        <div class="card-content" style="padding:28px;">
          <div style="color:var(--muted); font-size:12px; font-weight:700; text-transform:uppercase;">${f.restaurant_name}</div>
          <h3 style="font-size:22px; margin:10px 0;">${f.name}</h3>
          <div class="price-row">
            <div class="price-main">₹${Math.ceil(f.price)}</div>
            <div style="color:var(--accent); font-weight:800; font-size:12px;">RESCUE NOW</div>
          </div>
        </div>
      </div>
    `).join('');
  }

  // --- MODAL & DRAWER ---
  const modal = document.getElementById('foodModal');
  const drawer = document.getElementById('profileOverlay');

  function openModal(id) {
    const f = allFoods.find(item => item.id == id);
    if(!f) return;
    document.getElementById('m-banner').style.backgroundImage = `url(${f.image_url || getImg(f.name)})`;
    document.getElementById('m-title').innerText = f.name;
    document.getElementById('m-kitchen').innerText = f.restaurant_name;
    document.getElementById('m-desc').innerText = f.description || "Authentic Kerala flavors prepared fresh today. High-end rescue for the ultimate gourmet experience.";
    document.getElementById('m-price').innerText = `₹${Math.ceil(f.price)}`;
    document.getElementById('m-left').innerText = `${f.available_quantity} Left`;
    document.getElementById('m-link').href = `/checkout/${f.id}`;
    modal.classList.add('active');
  }

  function closeModal() { modal.classList.remove('active'); }

  document.getElementById('openProfile').onclick = () => drawer.classList.add('active');
  document.getElementById('closeProfile').onclick = () => drawer.classList.remove('active');

  // --- THEME TOGGLE ---
  const themeToggle = document.getElementById("themeToggle");
  if(localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light');
    themeToggle.checked = true;
  }
  themeToggle.onchange = () => {
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
  };

  init();
</script>
</body>
</html>
