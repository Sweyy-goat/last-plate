<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Last Plate – Order</title>

<style>
:root{
  --bg:#f3f4f6;
  --panel:#ffffff;
  --muted:#6b7280;
  --text:#111827;
  --accent:#16a34a;
  --radius:22px;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:#1f2933;
  font-family: Inter, system-ui, sans-serif;
}

/* ===== APP ===== */
.app{
  max-width:1280px;
  margin:30px auto;
  background:var(--bg);
  border-radius:32px;
  padding:24px;
}

/* ===== TOP BAR ===== */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--panel);
  padding:16px 22px;
  border-radius:var(--radius);
}

.logo{
  font-weight:800;
  font-size:18px;
}

.nav{
  display:flex;
  gap:18px;
  font-size:14px;
  color:var(--muted);
}

.cart-btn{
  background:#ef4444;
  color:#fff;
  padding:10px 16px;
  border-radius:999px;
  font-weight:600;
}

/* ===== GRID ===== */
.content{
  margin-top:24px;
  display:grid;
  grid-template-columns:220px 1fr 300px;
  gap:24px;
}

/* ===== LEFT ===== */
.left{
  background:var(--panel);
  border-radius:var(--radius);
  padding:16px;
}

.left h4{
  margin:0 0 12px;
}

.pills{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.pill{
  padding:8px 14px;
  border-radius:999px;
  background:#f3f4f6;
  font-size:13px;
  cursor:pointer;
}

.pill.active{
  background:#111827;
  color:#fff;
}

/* ===== CENTER ===== */
.center{
  background:var(--panel);
  border-radius:var(--radius);
  padding:22px;
}

.product{
  display:grid;
  grid-template-columns:320px 1fr;
  gap:28px;
}

.product img{
  width:100%;
  border-radius:50%;
}

.product h1{
  margin:0;
  font-size:28px;
}

.desc{
  color:var(--muted);
  font-size:14px;
  margin-top:6px;
}

.meta{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

.buy{
  margin-top:24px;
  display:flex;
  align-items:center;
  gap:16px;
}

.price{
  font-size:20px;
  font-weight:800;
  color:var(--accent);
}

.buy button{
  padding:12px 22px;
  border:none;
  border-radius:999px;
  background:#111827;
  color:white;
  font-weight:600;
  cursor:pointer;
}

/* ===== CART ===== */
.cart{
  background:var(--panel);
  border-radius:var(--radius);
  padding:18px;
}

.cart h4{
  margin:0 0 12px;
}

.cart-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 0;
  border-bottom:1px dashed #e5e7eb;
}

.cart-item img{
  width:44px;
  height:44px;
  border-radius:50%;
  object-fit:cover;
}

.cart-item span{
  font-size:13px;
}

.total{
  margin-top:16px;
  font-weight:700;
}

.checkout{
  margin-top:14px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:999px;
  background:#ef4444;
  color:white;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="logo">Last Plate</div>
    <div class="nav">
      <span>Main Dishes</span>
      <span>Vegan</span>
      <span>Street Food</span>
      <span>Desserts</span>
    </div>
    <div class="cart-btn">Cart</div>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- LEFT -->
    <div class="left">
      <h4>Meal Category</h4>
      <div class="pills" id="categoryPills"></div>
    </div>

    <!-- CENTER -->
    <div class="center" id="productView">
      <div style="color:#999">Loading…</div>
    </div>

    <!-- RIGHT -->
    <div class="cart">
      <h4>My Order</h4>
      <div id="cartItems"></div>
      <div class="total" id="cartTotal">Total ₹0</div>
      <button class="checkout" onclick="checkout()">Confirm Order</button>
    </div>

  </div>
</div>

<script>
let foods = [];
let filteredFoods = [];
let selectedFood = null;
let cart = [];

/* ===== IMAGE ENGINE (YOUR PROJECT STYLE) ===== */
function normalize(name){
  return name.toLowerCase();
}
function getFoodImage(name){
  const n = normalize(name);
  if(n.includes("biryani")) return "https://images.unsplash.com/photo-1600628422019-0d6d3c1fcb90";
  if(n.includes("alfahm")) return "https://img.onmanorama.com/content/dam/mm/en/food/recipe/images/2021/2/14/alfaham.jpg";
  if(n.includes("shawarma")) return "https://images.unsplash.com/photo-1604908554166-90a3f0e35318";
  if(n.includes("mandhi")) return "https://images.unsplash.com/photo-1628294896516-344152572c7b";
  return "https://images.unsplash.com/photo-1543352634-6c8e8b3a8e01";
}

/* ===== FETCH FOODS ===== */
fetch("/api/foods")
.then(r=>r.json())
.then(d=>{
  foods = d.foods || [];
  filteredFoods = foods;
  buildCategories();
  if(foods.length) selectFood(foods[0]);
});

/* ===== CATEGORIES ===== */
function buildCategories(){
  const pills = document.getElementById("categoryPills");
  const cats = [...new Set(foods.map(f => f.name.split(" ")[0]))];

  pills.innerHTML = "";
  cats.forEach((c,i)=>{
    const el = document.createElement("div");
    el.className = "pill" + (i===0?" active":"");
    el.textContent = c;
    el.onclick = () => {
      document.querySelectorAll(".pill").forEach(p=>p.classList.remove("active"));
      el.classList.add("active");
      filteredFoods = foods.filter(f => f.name.toLowerCase().includes(c.toLowerCase()));
      selectFood(filteredFoods[0]);
    };
    pills.appendChild(el);
  });
}

/* ===== PRODUCT VIEW ===== */
function selectFood(food){
  if(!food) return;
  selectedFood = food;

  document.getElementById("productView").innerHTML = `
    <div class="product">
      <img src="${getFoodImage(food.name)}">
      <div>
        <h1>${food.name}</h1>
        <div class="desc">${food.restaurant_name}</div>
        <div class="meta">Pickup ${food.pickup_start} – ${food.pickup_end}</div>
        <div class="meta">Available ${food.available_quantity}</div>

        <div class="buy">
          <div class="price">₹${food.price}</div>
          <button onclick="addToCart()">Add to order</button>
        </div>
      </div>
    </div>
  `;
}

/* ===== CART ===== */
function addToCart(){
  cart.push(selectedFood);
  renderCart();
}

function renderCart(){
  const el = document.getElementById("cartItems");
  el.innerHTML = "";
  let total = 0;

  cart.forEach(f=>{
    total += f.price;
    el.innerHTML += `
      <div class="cart-item">
        <img src="${getFoodImage(f.name)}">
        <span>${f.name}</span>
      </div>
    `;
  });

  document.getElementById("cartTotal").textContent = "Total ₹" + total;
}

/* ===== CHECKOUT ===== */
function checkout(){
  if(cart.length === 0) return alert("Cart is empty");
  window.location.href = "/checkout/" + cart[0].id;
}
</script>

</body>
</html>
