<!DOCTYPE html>
<html>
<head>
  <title>Last Plate ‚Äì Nearby Food</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#22c55e;
    }

    body.light{
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background:var(--bg);
      color:var(--text);
      transition:.3s;
    }

    /* ===== TOP BAR ===== */
    .topbar{
      position:fixed;
      top:0;left:0;right:0;
      height:64px;
      padding:0 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(14px);
      z-index:100;
    }

    .topbar h2{margin:0;font-size:20px}

    .profile-btn{
      width:42px;height:42px;
      border-radius:50%;
      border:none;
      background:var(--accent);
      color:#022c22;
      font-size:18px;
      cursor:pointer;
      font-weight:700;
    }

    /* ===== HERO ===== */
    .hero{
      height:300px;
      background:url("https://images.unsplash.com/photo-1528605248644-14dd04022da1?q=80&w=1920&auto=format&fit=crop") center/cover;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-top:64px;
    }

    .hero::before{
      content:"";
      position:absolute;inset:0;
      background:linear-gradient(rgba(5,8,15,.85),rgba(5,8,15,.95));
    }

    .hero-content{
      position:relative;
      z-index:1;
      text-align:center;
    }

    .hero h1{font-size:52px;margin:0}
    .hero p{opacity:.85;font-size:18px}

    /* ===== FOOD GRID ===== */
    .container{
      max-width:1100px;
      margin:-40px auto 40px;
      padding:0 20px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:22px;
    }

    .card{
      border-radius:18px;
      padding:18px;
      background-size:cover;
      background-position:center;
      position:relative;
      overflow:hidden;
      box-shadow:0 20px 40px rgba(0,0,0,.4);
      transition:.25s;
    }

    .card:hover{transform:translateY(-4px)}

    .card::before{
      content:"";
      position:absolute;inset:0;
      background:linear-gradient(rgba(10,12,15,.65),rgba(10,12,15,.85));
      z-index:1;
    }

    .card-content{
      position:relative;
      z-index:2;
    }

    .price{
      font-size:22px;
      font-weight:800;
      color:#4ade80;
    }

    .meta{font-size:14px;color:var(--muted)}

    .card button{
      margin-top:14px;
      width:100%;
      padding:12px;
      border-radius:14px;
      border:none;
      font-size:15px;
      font-weight:700;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;
      cursor:pointer;
    }

    .empty{
      text-align:center;
      grid-column:1/-1;
      margin:80px 0;
      opacity:.6;
      font-size:18px;
    }

    /* ===== PROFILE PANEL ===== */
    .profile-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:none;
      justify-content:flex-end;
      z-index:200;
    }

    .profile{
      width:340px;
      height:100%;
      background:var(--card);
      padding:24px;
      overflow:auto;
    }

    .profile h3{margin-top:0}

    .row{
      margin:12px 0;
      font-size:14px;
    }

    .row span{color:var(--muted)}

    .divider{
      height:1px;
      background:#334155;
      margin:18px 0;
    }

    .history{
      margin-top:10px;
      font-size:13px;
    }

    .order{
      padding:10px;
      border-radius:10px;
      background:rgba(0,0,0,.2);
      margin-bottom:8px;
    }

    .toggle{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .logout{
      width:100%;
      padding:14px;
      margin-top:20px;
      border:none;
      border-radius:12px;
      background:#ef4444;
      color:white;
      font-weight:700;
      cursor:pointer;
    }
  </style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <h2>Last Plate</h2>
  <button class="profile-btn" id="openProfile">üë§</button>
</div>

<!-- HERO -->
<section class="hero">
  <div class="hero-content">
    <h1>üçΩÔ∏è Last Plate</h1>
    <p>Late nights ‚Ä¢ Fresh food ‚Ä¢ Zero waste</p>
  </div>
</section>

<!-- FOOD LIST -->
<div class="container" id="foodList"></div>

<!-- PROFILE PANEL -->
<div class="profile-overlay" id="profileOverlay">
  <div class="profile">
    <h3>Your Profile</h3>

    <div class="row"><span>Name</span><br><b id="p-name"></b></div>
    <div class="row"><span>Email</span><br><b id="p-email"></b></div>
    <div class="row"><span>Phone</span><br><b id="p-mobile"></b></div>

    <div class="divider"></div>

    <div class="toggle">
      <span>Light mode</span>
      <input type="checkbox" id="themeToggle">
    </div>

    <div class="divider"></div>

    <h4>Order History</h4>
    <div class="history" id="history"></div>

    <button class="logout" onclick="location.href='/logout'">Logout</button>
  </div>
</div>

<script>
  function normalize(name) {
  return name
    .toLowerCase()
    .replace(/[-_]/g, " ")
    .replace(/[^a-z\s]/g, "")
    .replace(/\s+/g, " ")
    .trim();
}

function getFoodImage(name) {
  const n = normalize(name);

  /* üî• AL FAHM */
  if (
    n.includes("alfahm") ||
    n.includes("al fahm") ||
    n.includes("fahm")
  ) {
    return "https://img.onmanorama.com/content/dam/mm/en/food/recipe/images/2021/2/14/alfaham.jpg";
  }

  /* üçö BIRYANI */
  if (
    n.includes("biryani") ||
    n.includes("biriyani") ||
    n.includes("briyani")
  ) {
    return "https://www.apnachef.com/wp-content/uploads/2023/12/chicken-biryani-50-people-wide.jpg";
  }

  /* üçó MANDHI */
  if (n.includes("mandhi") || n.includes("mandy")) {
    return "https://images.unsplash.com/photo-1628294896516-344152572c7b?auto=format&fit=crop&w=900&q=80";
  }

  /* ü´ì PAROTTA */
  if (n.includes("parotta") || n.includes("porotta")) {
    return "https://images.unsplash.com/photo-1631515242808-497c3fbd3972?auto=format&fit=crop&w=900&q=80";
  }

  /* üåØ SHAWARMA */
  if (n.includes("shawarma")) {
    return "https://images.unsplash.com/photo-1604908554166-90a3f0e35318?auto=format&fit=crop&w=900&q=80";
  }

  /* üçî BURGER */
  if (n.includes("burger")) {
    return "https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=900&q=80";
  }

  /* üçï PIZZA */
  if (n.includes("pizza")) {
    return "https://images.unsplash.com/photo-1548365328-9f547fb09502?auto=format&fit=crop&w=900&q=80";
  }

  /* üçü FRIES */
  if (n.includes("fries")) {
    return "https://images.unsplash.com/photo-1573080496219-bb080dd4f877?auto=format&fit=crop&w=900&q=80";
  }

  /* üßÜ CHAPATI / ROTI */
  if (n.includes("chapati") || n.includes("roti")) {
    return "https://images.unsplash.com/photo-1601050690597-df0568f70950?auto=format&fit=crop&w=900&q=80";
  }

  /* üçñ RIBS */
  if (n.includes("ribs")) {
    return "https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=900&q=80";
  }

  /* üçΩÔ∏è FALLBACK */
  return "https://images.unsplash.com/photo-1543352634-6c8e8b3a8e01?auto=format&fit=crop&w=900&q=80";
}

/* ===== PROFILE ===== */
const overlay=document.getElementById("profileOverlay");

document.getElementById("openProfile").onclick=()=>{
  overlay.style.display="flex";
  loadProfile();
};

overlay.onclick=e=>{
  if(e.target===overlay) overlay.style.display="none";
};

function loadProfile(){
  fetch("/api/user/profile")
    .then(r=>r.json())
    .then(u=>{
      p-name.innerText=u.name;
      p-email.innerText=u.email||"‚Äî";
      p-mobile.innerText=u.mobile;
    });

  fetch("/api/user/orders")
    .then(r=>r.json())
    .then(list=>{
      history.innerHTML=list.length
        ? list.map(o=>`
          <div class="order">
            <b>${o.food}</b><br>
            Qty: ${o.quantity} ‚Ä¢ ‚Çπ${o.total_amount}<br>
            Status: ${o.status}
          </div>
        `).join("")
        : "<i>No orders yet</i>";
    });
}

/* ===== THEME ===== */
const toggle=document.getElementById("themeToggle");
if(localStorage.theme==="light"){
  document.body.classList.add("light");
  toggle.checked=true;
}
toggle.onchange=()=>{
  document.body.classList.toggle("light");
  localStorage.theme=toggle.checked?"light":"dark";
};

/* ===== FOOD FETCH (UNCHANGED LOGIC) ===== */
fetch("/api/foods")
.then(r=>r.json())
.then(d=>{
  const list=document.getElementById("foodList");
  if(!d.foods||!d.foods.length){
    list.innerHTML=`<div class="empty">No food available üåô</div>`;
    return;
  }
  d.foods.forEach(f=>{
    list.innerHTML+=`
      <div class="card" style="background-image:url('https://images.unsplash.com/photo-1543352634-6c8e8b3a8e01?auto=format&fit=crop&w=900&q=80')">
        <div class="card-content">
          <h3>${f.name}</h3>
          <div class="meta">${f.restaurant_name}</div>
          <div class="price">‚Çπ${f.price}</div>
          <div class="meta">Available: ${f.available_quantity}</div>
          <a href="/checkout/${f.id}">
            <button>Reserve quietly ü§ç</button>
          </a>
        </div>
      </div>`;
  });
});
</script>

</body>
</html>

