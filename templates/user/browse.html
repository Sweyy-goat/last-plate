<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Last Plate ‚Äî Browse</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">

<style>
/* =====================
   LIGHT TOKENS (default)
===================== */
:root {
  --white:     #FFFFFF;
  --bg:        #F7F6F2;
  --bg-2:      #EFEDE7;
  --border:    #E4E1D9;
  --border-2:  #D0CCC2;
  --ink:       #1A1916;
  --ink-2:     #5C5950;
  --ink-3:     #9B978E;
  --green:     #3D7A2E;
  --green-l:   #4E9B3C;
  --green-bg:  #EDF5EB;
  --green-bd:  #C2DBBE;
  --red:       #C8391A;
  --red-bg:    #FDF0ED;
  --gold:      #A87128;
  --gold-bg:   #FDF6EC;
  --shadow-sm: 0 1px 3px rgba(26,25,22,0.06), 0 1px 2px rgba(26,25,22,0.04);
  --shadow-md: 0 4px 16px rgba(26,25,22,0.08), 0 2px 6px rgba(26,25,22,0.05);
  --shadow-lg: 0 16px 48px rgba(26,25,22,0.12), 0 4px 12px rgba(26,25,22,0.06);
  --shadow-xl: 0 32px 80px rgba(26,25,22,0.16);
  --r-sm: 12px; --r-md: 18px; --r-lg: 24px; --r-xl: 32px;
  --spring: cubic-bezier(0.16, 1, 0.3, 1);
  --bounce:  cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* =====================
   DARK TOKENS
===================== */
html.dark {
  --white:     #1C1E1A;
  --bg:        #141612;
  --bg-2:      #1E2019;
  --border:    #2C2F27;
  --border-2:  #3A3E33;
  --ink:       #EDE8DC;
  --ink-2:     #B0AA9E;
  --ink-3:     #6E6A62;
  --green:     #6DB85A;
  --green-l:   #80D16A;
  --green-bg:  #1A2918;
  --green-bd:  #2D4A28;
  --red:       #E8593A;
  --red-bg:    #2A1410;
  --gold:      #C89444;
  --gold-bg:   #251C0A;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.35), 0 2px 6px rgba(0,0,0,0.2);
  --shadow-lg: 0 16px 48px rgba(0,0,0,0.5), 0 4px 12px rgba(0,0,0,0.3);
  --shadow-xl: 0 32px 80px rgba(0,0,0,0.6);
}

/* =====================
   RESET
===================== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Sora', sans-serif;
  background: var(--bg);
  color: var(--ink);
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
  transition: background 0.35s, color 0.35s;
}

a { text-decoration: none; color: inherit; }
button { font-family: inherit; cursor: pointer; }
input { font-family: inherit; }

/* =====================
   SCROLL PROGRESS
===================== */
.scroll-bar {
  position: fixed;
  top: 0; left: 0;
  height: 2.5px;
  background: var(--green);
  z-index: 9999;
  width: 0%;
  transition: width 0.08s linear;
  border-radius: 0 2px 2px 0;
}

/* =====================
   NAVBAR
===================== */
.navbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 68px;
  padding: 0 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 1000;
  transition: background 0.3s, box-shadow 0.3s;
}

.navbar.scrolled {
  background: rgba(247,246,242,0.92);
  backdrop-filter: blur(20px);
  box-shadow: 0 1px 0 var(--border);
}

html.dark .navbar.scrolled {
  background: rgba(20,22,18,0.92);
}

.nav-logo {
  display: flex;
  align-items: center;
  gap: 9px;
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--ink);
  letter-spacing: -0.02em;
}

.nav-logo-dot {
  width: 8px; height: 8px;
  background: var(--green);
  border-radius: 50%;
  flex-shrink: 0;
  box-shadow: 0 0 0 3px rgba(61,122,46,0.15);
}

.nav-live {
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 7px 14px;
  background: var(--green-bg);
  border: 1px solid var(--green-bd);
  border-radius: 100px;
  font-size: 0.68rem;
  font-weight: 600;
  color: var(--green);
  letter-spacing: 0.05em;
}

.live-dot {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
  animation: blink 2s ease infinite;
}

@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

.nav-right { display: flex; align-items: center; gap: 10px; }

.icon-btn {
  width: 40px; height: 40px;
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  display: flex; align-items: center; justify-content: center;
  color: var(--ink-2);
  transition: all 0.25s var(--spring);
  box-shadow: var(--shadow-sm);
}

.icon-btn:hover {
  border-color: var(--border-2);
  color: var(--ink);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}

/* Theme button icon */
.icon-btn .sun-icon  { display: none; }
.icon-btn .moon-icon { display: block; }
html.dark .icon-btn .sun-icon  { display: block; }
html.dark .icon-btn .moon-icon { display: none; }

/* =====================
   HERO
===================== */
.hero {
  padding: 120px 40px 56px;
  max-width: 1200px;
  margin: 0 auto;
}

.hero-kicker {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--green);
  margin-bottom: 20px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.1s forwards;
}

.hero-kicker span { width: 20px; height: 1px; background: var(--green); display: inline-block; }

.hero-h1 {
  font-family: 'Instrument Serif', serif;
  font-size: clamp(2.8rem, 6vw, 5.2rem);
  font-weight: 400;
  line-height: 1.1;
  letter-spacing: -0.02em;
  color: var(--ink);
  margin-bottom: 18px;
  opacity: 0;
  animation: riseIn 0.9s var(--spring) 0.2s forwards;
}

.hero-h1 em { font-style: italic; color: var(--green); }

.hero-sub {
  font-size: 0.9rem;
  line-height: 1.75;
  color: var(--ink-2);
  max-width: 480px;
  font-weight: 400;
  opacity: 0;
  animation: riseIn 0.8s var(--spring) 0.35s forwards;
}

@keyframes riseIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: none; }
}

/* =====================
   CONTROLS
===================== */
.controls {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 40px 40px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.search-row { display: flex; gap: 12px; align-items: center; }

.search-box {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: var(--r-lg);
  padding: 14px 20px;
  box-shadow: var(--shadow-sm);
  transition: border-color 0.2s, box-shadow 0.2s;
}

.search-box:focus-within {
  border-color: var(--green);
  box-shadow: 0 0 0 3px rgba(61,122,46,0.12), var(--shadow-md);
}

.search-box svg { color: var(--ink-3); flex-shrink: 0; }

.search-box input {
  border: none;
  background: transparent;
  font-size: 0.9rem;
  color: var(--ink);
  width: 100%;
  font-weight: 400;
}

.search-box input:focus { outline: none; }
.search-box input::placeholder { color: var(--ink-3); }

.filter-scroll {
  display: flex; gap: 8px;
  overflow-x: auto; scrollbar-width: none;
  padding: 2px 0;
}
.filter-scroll::-webkit-scrollbar { display: none; }

.chip {
  flex-shrink: 0;
  padding: 9px 18px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 100px;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ink-2);
  cursor: pointer;
  transition: all 0.25s var(--spring);
  white-space: nowrap;
  letter-spacing: 0.01em;
  box-shadow: var(--shadow-sm);
  user-select: none;
}

.chip:hover {
  border-color: var(--border-2);
  color: var(--ink);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.chip.active {
  background: var(--green);
  border-color: var(--green);
  color: #fff;
  box-shadow: 0 4px 14px rgba(61,122,46,0.3);
  transform: translateY(-1px);
}

/* =====================
   SECTION HEADER
===================== */
.section-header {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 40px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.section-title {
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--ink-3);
}

.plate-count {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ink-3);
  background: var(--bg-2);
  border: 1px solid var(--border);
  padding: 5px 12px;
  border-radius: 100px;
}

/* =====================
   FOOD GRID
===================== */
.food-grid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 40px 80px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 20px;
}

/* =====================
   CARD
===================== */
.food-card {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.4s var(--spring), box-shadow 0.4s var(--spring), border-color 0.3s;
  box-shadow: var(--shadow-sm);
  animation: cardIn 0.5s var(--spring) both;
}

.food-card:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-lg);
  border-color: var(--border-2);
}

@keyframes cardIn {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: none; }
}

.card-img-wrap {
  position: relative; height: 210px;
  overflow: hidden; background: var(--bg-2);
}

.card-img {
  width: 100%; height: 100%;
  object-fit: cover;
  transition: transform 0.7s var(--spring);
}

.food-card:hover .card-img { transform: scale(1.06); }

.card-img-wrap::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(to bottom, transparent 50%, rgba(26,25,22,0.35) 100%);
  pointer-events: none;
}

.card-badges {
  position: absolute;
  top: 14px; left: 14px; right: 14px;
  display: flex; justify-content: space-between; z-index: 2;
}

.badge {
  display: flex; align-items: center; gap: 5px;
  padding: 5px 11px; border-radius: 8px;
  font-size: 0.65rem; font-weight: 700;
  backdrop-filter: blur(12px); letter-spacing: 0.04em;
}

.badge-qty {
  background: rgba(255,255,255,0.92);
  color: var(--green);
  border: 1px solid rgba(255,255,255,0.6);
}

.badge-time {
  background: rgba(26,25,22,0.7);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.08);
}

.badge-time.urgent {
  background: rgba(200,57,26,0.85);
  animation: urgentPulse 1.8s ease infinite;
}

@keyframes urgentPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(200,57,26,0.4); }
  50%       { box-shadow: 0 0 0 5px rgba(200,57,26,0); }
}

.discount-pill {
  position: absolute; bottom: 14px; left: 14px; z-index: 2;
  padding: 4px 10px;
  background: var(--gold-bg);
  border: 1px solid rgba(168,113,40,0.25);
  border-radius: 8px;
  font-size: 0.63rem; font-weight: 700;
  color: var(--gold); letter-spacing: 0.04em;
}

.card-body { padding: 22px 24px 24px; }

.card-restaurant {
  font-size: 0.68rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-3); margin-bottom: 6px;
}

.card-name {
  font-family: 'Instrument Serif', serif;
  font-size: 1.4rem; font-weight: 400;
  letter-spacing: -0.01em; color: var(--ink);
  line-height: 1.2; margin-bottom: 18px;
}

.card-footer {
  display: flex; align-items: center;
  justify-content: space-between;
  padding-top: 18px;
  border-top: 1px solid var(--border);
}

.price-mrp {
  font-size: 0.7rem; color: var(--ink-3);
  text-decoration: line-through;
  display: block; margin-bottom: 1px;
}

.price-now {
  font-size: 1.55rem; font-weight: 700;
  letter-spacing: -0.03em; color: var(--ink); line-height: 1;
}

.card-reserve-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 11px 20px;
  background: var(--green); color: #fff;
  border: none; border-radius: var(--r-md);
  font-size: 0.75rem; font-weight: 700;
  letter-spacing: 0.03em;
  transition: all 0.3s var(--spring);
  cursor: pointer; position: relative; overflow: hidden;
}

.food-card:hover .card-reserve-btn {
  background: var(--green-l);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(61,122,46,0.35);
}

/* =====================
   SKELETON
===================== */
.skeleton-card {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  overflow: hidden; box-shadow: var(--shadow-sm);
}

.skel-img {
  height: 210px;
  background: linear-gradient(90deg, var(--bg-2) 25%, var(--bg) 50%, var(--bg-2) 75%);
  background-size: 400% 100%;
  animation: shimmer 1.6s ease-in-out infinite;
}

.skel-body { padding: 22px 24px 24px; }

.skel-line {
  border-radius: 6px;
  background: linear-gradient(90deg, var(--bg-2) 25%, var(--bg) 50%, var(--bg-2) 75%);
  background-size: 400% 100%;
  animation: shimmer 1.6s ease-in-out infinite;
  margin-bottom: 10px;
}

@keyframes shimmer {
  0%   { background-position: 100% center; }
  100% { background-position: -100% center; }
}

/* =====================
   EMPTY STATE
===================== */
.empty-state {
  grid-column: 1/-1;
  padding: 100px 20px;
  text-align: center;
  display: flex; flex-direction: column;
  align-items: center; gap: 12px;
}

.empty-icon {
  width: 72px; height: 72px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.8rem; margin-bottom: 8px;
}

.empty-title {
  font-family: 'Instrument Serif', serif;
  font-size: 1.6rem; color: var(--ink-2); font-weight: 400;
}

.empty-sub { font-size: 0.8rem; color: var(--ink-3); line-height: 1.6; }

/* =====================
   MODAL
===================== */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(26,25,22,0);
  backdrop-filter: blur(0px);
  display: flex; align-items: center; justify-content: center;
  z-index: 5000; padding: 20px;
  pointer-events: none;
  transition: background 0.35s, backdrop-filter 0.35s;
}

.modal-overlay.open {
  background: rgba(26,25,22,0.55);
  backdrop-filter: blur(16px);
  pointer-events: all;
}

.modal-box {
  width: 100%; max-width: 520px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  overflow: hidden;
  box-shadow: var(--shadow-xl);
  transform: translateY(32px) scale(0.97); opacity: 0;
  transition: transform 0.5s var(--spring), opacity 0.4s ease;
}

.modal-overlay.open .modal-box { transform: none; opacity: 1; }

.modal-img { width: 100%; height: 280px; object-fit: cover; display: block; }

.modal-close {
  position: absolute; top: 16px; right: 16px;
  width: 36px; height: 36px;
  background: rgba(255,255,255,0.9); backdrop-filter: blur(8px);
  border: 1px solid rgba(26,25,22,0.1);
  border-radius: 50%; color: var(--ink);
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; z-index: 2;
  transition: all 0.25s var(--spring);
}

.modal-close:hover { background: #fff; transform: scale(1.1) rotate(90deg); }
.modal-img-wrap { position: relative; }

.modal-body { padding: 28px 32px 32px; }

.modal-kicker {
  font-size: 0.65rem; font-weight: 700;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--green); margin-bottom: 8px;
  display: flex; align-items: center; gap: 6px;
}

.modal-title {
  font-family: 'Instrument Serif', serif;
  font-size: 1.9rem; font-weight: 400;
  letter-spacing: -0.02em; color: var(--ink);
  line-height: 1.15; margin-bottom: 6px;
}

.modal-restaurant {
  font-size: 0.78rem; color: var(--ink-3);
  font-weight: 500; margin-bottom: 20px;
  display: flex; align-items: center; gap: 5px;
}

.modal-desc-box {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--r-md);
  padding: 16px 18px;
  font-size: 0.8rem; line-height: 1.7;
  color: var(--ink-2); margin-bottom: 24px;
}

.modal-footer {
  display: flex; align-items: center;
  justify-content: space-between; gap: 16px;
}

.modal-mrp {
  font-size: 0.72rem; color: var(--ink-3);
  text-decoration: line-through; display: block; margin-bottom: 2px;
}

.modal-price {
  font-size: 2rem; font-weight: 700;
  letter-spacing: -0.04em; color: var(--ink); line-height: 1;
}

.modal-cta {
  flex: 1; display: flex; align-items: center;
  justify-content: center; gap: 8px;
  padding: 16px 24px;
  background: var(--green); color: #fff;
  border-radius: var(--r-md);
  font-size: 0.82rem; font-weight: 700; letter-spacing: 0.04em;
  transition: all 0.3s var(--spring);
  border: none; cursor: pointer;
}

.modal-cta:hover {
  background: var(--green-l);
  transform: translateY(-2px);
  box-shadow: 0 10px 28px rgba(61,122,46,0.35);
}

/* =====================
   PROFILE DRAWER
===================== */
.drawer-overlay {
  position: fixed; inset: 0;
  z-index: 4000; pointer-events: none;
}

.drawer-overlay.open { pointer-events: all; }

.drawer-scrim {
  position: absolute; inset: 0;
  background: rgba(26,25,22,0); backdrop-filter: blur(0px);
  transition: background 0.4s, backdrop-filter 0.4s;
}

.drawer-overlay.open .drawer-scrim {
  background: rgba(26,25,22,0.45);
  backdrop-filter: blur(12px);
}

.drawer-panel {
  position: absolute; top: 0; right: 0; bottom: 0;
  width: min(440px, 94vw);
  background: var(--white);
  border-left: 1.5px solid var(--border);
  box-shadow: var(--shadow-xl);
  padding: 40px 36px;
  overflow-y: auto;
  transform: translateX(100%);
  transition: transform 0.5s var(--spring);
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}

.drawer-overlay.open .drawer-panel { transform: none; }

#page-root {
  transition: transform 0.5s var(--spring), filter 0.5s ease, border-radius 0.5s ease;
}

.page-pushed #page-root {
  transform: scale(0.94) translateX(-28px);
  filter: blur(6px) brightness(0.7);
  border-radius: 20px;
  pointer-events: none; overflow: hidden;
}

.drawer-back {
  display: inline-flex; align-items: center; gap: 8px;
  background: none; border: none;
  font-size: 0.72rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--green); cursor: pointer;
  margin-bottom: 36px;
  transition: gap 0.25s;
}

.drawer-back:hover { gap: 12px; }

.drawer-title {
  font-family: 'Instrument Serif', serif;
  font-size: 2.4rem; font-weight: 400;
  letter-spacing: -0.03em; color: var(--ink); margin-bottom: 28px;
}

.drawer-card {
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--r-lg);
  padding: 20px 22px; margin-bottom: 12px;
}

.drawer-label {
  font-size: 0.62rem; font-weight: 700;
  letter-spacing: 0.12em; text-transform: uppercase;
  color: var(--ink-3); margin-bottom: 6px;
}

.drawer-value {
  font-size: 1.2rem; font-weight: 600;
  color: var(--ink); letter-spacing: -0.01em;
}

.drawer-row {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--r-lg);
  padding: 18px 22px; margin-bottom: 28px;
}

.drawer-row-label {
  font-size: 0.82rem; font-weight: 600; color: var(--ink-2);
  display: flex; align-items: center; gap: 8px;
}

/* Moon/sun icon in the label */
.theme-icon-sun  { display: none; }
.theme-icon-moon { display: inline; }
html.dark .theme-icon-sun  { display: inline; }
html.dark .theme-icon-moon { display: none; }

/* Toggle */
.toggle {
  width: 48px; height: 26px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 100px; position: relative;
  cursor: pointer;
  transition: background 0.25s var(--spring), border-color 0.25s;
  flex-shrink: 0;
}

.toggle-thumb {
  position: absolute; top: 3px; left: 3px;
  width: 18px; height: 18px;
  background: var(--ink-3); border-radius: 50%;
  transition: transform 0.3s var(--bounce), background 0.25s;
  box-shadow: 0 1px 4px rgba(26,25,22,0.2);
}

.toggle.on { background: var(--green); border-color: var(--green); }
.toggle.on .toggle-thumb { transform: translateX(22px); background: #fff; }

.drawer-section-title {
  font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--ink-3); margin-bottom: 14px;
}

.history-item {
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--r-md);
  padding: 16px 18px; margin-bottom: 8px;
  transition: border-color 0.2s;
}

.history-item:hover { border-color: var(--border-2); }

.history-name { font-size: 0.9rem; font-weight: 600; color: var(--ink); margin-bottom: 4px; }
.history-meta { font-size: 0.7rem; color: var(--ink-3); }

.drawer-logout {
  width: 100%; margin-top: 36px; padding: 15px;
  background: var(--red-bg);
  border: 1.5px solid rgba(200,57,26,0.2);
  border-radius: var(--r-md);
  color: var(--red);
  font-size: 0.78rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  cursor: pointer;
  transition: all 0.25s var(--spring);
}

.drawer-logout:hover {
  background: rgba(200,57,26,0.12);
  border-color: rgba(200,57,26,0.4);
  transform: translateY(-1px);
}

/* =====================
   SUPPORT SECTION
===================== */
.support-section {
  max-width: 1200px; margin: 0 auto;
  padding: 0 40px 80px;
}

.support-card-wrap {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: var(--r-xl);
  padding: 60px 56px;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 48px; align-items: center;
  box-shadow: var(--shadow-sm);
}

.support-heading {
  font-family: 'Instrument Serif', serif;
  font-size: clamp(1.8rem, 3.5vw, 2.8rem);
  font-weight: 400; letter-spacing: -0.03em;
  color: var(--ink); line-height: 1.15; margin-bottom: 10px;
}

.support-heading em { font-style: italic; color: var(--green); }

.support-desc {
  font-size: 0.82rem; color: var(--ink-3);
  line-height: 1.7; max-width: 380px; margin-bottom: 32px;
}

.support-links { display: flex; flex-direction: column; gap: 10px; }

.support-link {
  display: flex; align-items: center; gap: 14px;
  padding: 16px 20px;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--r-md);
  transition: all 0.3s var(--spring);
  cursor: pointer; color: inherit;
}

.support-link:hover {
  border-color: var(--green-bd);
  background: var(--green-bg);
  transform: translateX(4px);
  box-shadow: var(--shadow-sm);
}

.support-link-icon {
  width: 36px; height: 36px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; flex-shrink: 0;
}

.support-link-label {
  font-size: 0.72rem; font-weight: 700;
  color: var(--ink); display: block; margin-bottom: 1px;
}

.support-link-value { font-size: 0.68rem; color: var(--ink-3); }

.support-decor {
  width: 220px; height: 220px;
  background: var(--green-bg);
  border: 1.5px solid var(--green-bd);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 5rem; flex-shrink: 0;
}

/* =====================
   FOOTER
===================== */
footer {
  border-top: 1px solid var(--border);
  padding: 48px 40px;
  max-width: 1200px; margin: 0 auto;
  display: flex; align-items: center; justify-content: space-between;
}

.footer-left { display: flex; align-items: center; gap: 10px; }

.footer-logo {
  font-family: 'Instrument Serif', serif;
  font-size: 1.2rem; color: var(--ink); font-weight: 400;
}

.footer-sep { width: 1px; height: 16px; background: var(--border); }
.footer-copy { font-size: 0.72rem; color: var(--ink-3); }

.footer-cta {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 12px 22px;
  border: 1.5px solid var(--border);
  border-radius: var(--r-md);
  font-size: 0.75rem; font-weight: 700;
  letter-spacing: 0.05em; color: var(--ink);
  background: var(--white);
  transition: all 0.3s var(--spring);
  box-shadow: var(--shadow-sm);
}

.footer-cta:hover {
  border-color: var(--green); color: var(--green);
  transform: translateY(-2px); box-shadow: var(--shadow-md);
}

/* =====================
   RESPONSIVE
===================== */
@media (max-width: 860px) {
  .navbar { padding: 0 20px; }
  .nav-live { display: none; }
  .hero { padding: 100px 20px 44px; }
  .controls, .section-header, .food-grid, .support-section, footer { padding-left: 20px; padding-right: 20px; }
  .support-card-wrap { grid-template-columns: 1fr; padding: 40px 28px; gap: 36px; }
  .support-decor { display: none; }
  footer { flex-direction: column; gap: 20px; text-align: center; align-items: center; }
}

/* =====================
   BOTTOM NAV
===================== */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 76px;
  background: var(--white);
  border-top: 1.5px solid var(--border);
  display: flex;
  align-items: stretch;
  z-index: 2000;
  backdrop-filter: blur(20px);
  padding-bottom: env(safe-area-inset-bottom);
  box-shadow: 0 -8px 32px rgba(26,25,22,0.08);
}

html.dark .bottom-nav {
  background: rgba(20,22,18,0.97);
  box-shadow: 0 -8px 32px rgba(0,0,0,0.35);
}

/* Vertical divider between two items */
.bottom-nav::after {
  content: '';
  position: absolute;
  left: 50%; top: 16px; bottom: 16px;
  width: 1.5px;
  background: var(--border);
  border-radius: 2px;
}

.bn-item {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 5px;
  flex: 1; height: 100%;
  background: none; border: none;
  cursor: pointer;
  color: var(--ink-3);
  transition: color 0.25s var(--spring), background 0.25s;
  position: relative;
  text-decoration: none;
}

.bn-item:hover { background: var(--bg-2); color: var(--ink-2); }
.bn-item.active { color: var(--green); }

/* Animated green pill under active tab */
.bn-item.active::before {
  content: '';
  position: absolute;
  top: 0; left: 50%;
  transform: translateX(-50%);
  width: 32px; height: 3px;
  background: var(--green);
  border-radius: 0 0 4px 4px;
  box-shadow: 0 2px 8px rgba(61,122,46,0.3);
  animation: slideDown 0.4s var(--bounce) forwards;
}

@keyframes slideDown {
  from { transform: translateX(-50%) scaleX(0); }
  to   { transform: translateX(-50%) scaleX(1); }
}

.bn-icon {
  width: 26px; height: 26px;
  display: flex; align-items: center; justify-content: center;
  position: relative;
}

.bn-label {
  font-size: 0.62rem;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

/* Secret menu red pulse badge */
.bn-badge {
  position: absolute;
  top: -3px; right: -5px;
  width: 9px; height: 9px;
  background: var(--red);
  border-radius: 50%;
  border: 2px solid var(--white);
  animation: urgentPulse 2s ease infinite;
}

html.dark .bn-badge { border-color: var(--bg); }

/* Extra body padding so content clears bottom nav */
body { padding-bottom: 80px; }

/* =====================
   SECRET MENU SHEET
===================== */
.secret-sheet-overlay {
  position: fixed; inset: 0;
  z-index: 3000;
  pointer-events: none;
}

.secret-sheet-overlay.open { pointer-events: all; }

.secret-scrim {
  position: absolute; inset: 0;
  background: rgba(26,25,22,0);
  backdrop-filter: blur(0px);
  transition: background 0.4s, backdrop-filter 0.4s;
}

.secret-sheet-overlay.open .secret-scrim {
  background: rgba(26,25,22,0.5);
  backdrop-filter: blur(16px);
}

.secret-sheet {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: var(--white);
  border-top: 1.5px solid var(--border);
  border-radius: 28px 28px 0 0;
  box-shadow: 0 -16px 64px rgba(26,25,22,0.18);
  transform: translateY(100%);
  transition: transform 0.55s var(--spring);
  max-height: 92vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.secret-sheet-overlay.open .secret-sheet {
  transform: translateY(0);
}

/* Drag handle */
.sheet-handle {
  width: 36px; height: 4px;
  background: var(--border-2);
  border-radius: 2px;
  margin: 14px auto 0;
  flex-shrink: 0;
}

/* Sheet header */
.sheet-header {
  padding: 18px 28px 0;
  flex-shrink: 0;
}

.sheet-title-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.sheet-title {
  display: flex; align-items: center; gap: 10px;
}

.sheet-title-icon {
  width: 38px; height: 38px;
  background: var(--ink);
  border-radius: 11px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem;
}

html.dark .sheet-title-icon { background: var(--bg-2); border: 1px solid var(--border); }

.sheet-title-text {
  font-family: 'Instrument Serif', serif;
  font-size: 1.5rem; font-weight: 400;
  letter-spacing: -0.02em; color: var(--ink);
}

.sheet-close {
  width: 34px; height: 34px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--ink-2);
  font-size: 0.85rem;
  transition: all 0.25s var(--spring);
  flex-shrink: 0;
}

.sheet-close:hover { background: var(--border); color: var(--ink); transform: rotate(90deg); }

/* Tab switcher */
.sheet-tabs {
  display: flex;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 14px;
  padding: 4px;
  margin-bottom: 20px;
}

.sheet-tab {
  flex: 1; padding: 10px 16px;
  background: none; border: none;
  border-radius: 11px;
  font-family: 'Sora', sans-serif;
  font-size: 0.72rem; font-weight: 700;
  letter-spacing: 0.04em;
  color: var(--ink-3);
  cursor: pointer;
  transition: all 0.3s var(--spring);
  display: flex; align-items: center; justify-content: center; gap: 6px;
}

.sheet-tab.active {
  background: var(--white);
  color: var(--ink);
  box-shadow: var(--shadow-sm);
}

html.dark .sheet-tab.active { background: var(--bg); }

/* Sheet body */
.sheet-body {
  flex: 1; overflow-y: auto;
  padding: 0 28px 28px;
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}

/* Tab panels */
.tab-panel { display: none; }
.tab-panel.active { display: block; animation: riseIn 0.4s var(--spring) both; }

/* Today's Specials */
.specials-kicker {
  font-size: 0.6rem; font-weight: 700;
  letter-spacing: 0.14em; text-transform: uppercase;
  color: var(--gold); margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
}

.specials-kicker span { width: 14px; height: 1px; background: var(--gold); display: inline-block; }

.special-card {
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.3s var(--spring);
  display: flex;
}

.special-card:hover {
  border-color: var(--border-2);
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.special-img {
  width: 100px; min-height: 100px;
  object-fit: cover;
  flex-shrink: 0;
}

.special-body {
  padding: 16px 18px;
  flex: 1; display: flex; flex-direction: column; justify-content: space-between;
}

.special-tag {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 3px 9px;
  background: var(--gold-bg);
  border: 1px solid rgba(168,113,40,0.2);
  border-radius: 6px;
  font-size: 0.58rem; font-weight: 700;
  letter-spacing: 0.08em; text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 6px;
  width: fit-content;
}

.special-name {
  font-family: 'Instrument Serif', serif;
  font-size: 1.1rem; font-weight: 400;
  letter-spacing: -0.01em; color: var(--ink);
  line-height: 1.2; margin-bottom: 4px;
}

.special-kitchen {
  font-size: 0.65rem; color: var(--ink-3);
  font-weight: 600; letter-spacing: 0.04em;
  text-transform: uppercase;
}

.special-footer {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-top: 10px;
}

.special-price {
  font-size: 1.1rem; font-weight: 700;
  letter-spacing: -0.02em; color: var(--ink);
}

.special-price .mrp {
  font-size: 0.65rem; font-weight: 400;
  color: var(--ink-3); text-decoration: line-through;
  margin-right: 4px;
}

.special-btn {
  padding: 7px 14px;
  background: var(--green); color: #fff;
  border: none; border-radius: 10px;
  font-size: 0.65rem; font-weight: 700;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: all 0.25s var(--spring);
}

.special-btn:hover { background: var(--green-l); transform: translateY(-1px); }

/* Secret menu search bar */
.sheet-search-box {
  display: flex; align-items: center; gap: 10px;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: var(--r-md);
  padding: 11px 16px;
  margin-bottom: 4px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.sheet-search-box:focus-within {
  border-color: var(--green);
  box-shadow: 0 0 0 3px rgba(61,122,46,0.1);
}

.sheet-search-box svg { color: var(--ink-3); flex-shrink: 0; }

.sheet-search-box input {
  flex: 1; border: none; background: transparent;
  font-family: 'Sora', sans-serif;
  font-size: 0.82rem; color: var(--ink);
  font-weight: 400;
}

.sheet-search-box input:focus { outline: none; }
.sheet-search-box input::placeholder { color: var(--ink-3); }

.sheet-search-clear {
  background: none; border: none;
  color: var(--ink-3); cursor: pointer;
  font-size: 0.75rem; padding: 2px 4px;
  border-radius: 4px;
  transition: color 0.2s;
  flex-shrink: 0;
}
.sheet-search-clear:hover { color: var(--ink); }

/* Search results container */
.search-results-panel {
  padding-top: 4px;
}

.search-result-card {
  display: flex; align-items: center; gap: 14px;
  padding: 13px 16px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 16px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.25s var(--spring);
  text-decoration: none; color: inherit;
}

.search-result-card:hover {
  border-color: var(--border-2);
  transform: translateX(3px);
  box-shadow: var(--shadow-sm);
}

.search-result-img {
  width: 48px; height: 48px;
  border-radius: 12px;
  object-fit: cover; flex-shrink: 0;
  background: var(--bg-2);
}

.search-result-info { flex: 1; min-width: 0; }

.search-result-name {
  font-size: 0.85rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.01em;
  margin-bottom: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.search-result-kitchen {
  font-size: 0.63rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-3);
}

.search-result-price {
  font-size: 0.95rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.02em;
  flex-shrink: 0;
}

.search-no-results {
  padding: 36px 20px; text-align: center;
  font-size: 0.78rem; color: var(--ink-3);
}

/* Restaurant chip counter */
.rest-chip-row {
  display: flex; gap: 8px;
  overflow-x: auto; scrollbar-width: none;
  padding-bottom: 16px; margin-bottom: 4px;
}
.rest-chip-row::-webkit-scrollbar { display: none; }

.rest-chip {
  flex-shrink: 0;
  display: flex; flex-direction: column; align-items: flex-start;
  padding: 10px 16px;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.25s var(--spring);
  font-family: 'Sora', sans-serif;
  text-align: left;
}

.rest-chip:hover {
  border-color: var(--border-2);
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}

.rest-chip.active {
  background: var(--green-bg);
  border-color: var(--green-bd);
  box-shadow: 0 4px 12px rgba(61,122,46,0.15);
}

.rest-chip-name {
  font-size: 0.75rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.01em;
  display: block;
}

.rest-chip-count {
  font-size: 0.6rem; color: var(--ink-3);
  margin-top: 2px;
}

.rest-chip.active .rest-chip-name { color: var(--green); }

/* Dishes list container */
.dishes-list { }

/* Special dish card description */
.special-desc {
  font-size: 0.65rem; color: var(--ink-3);
  line-height: 1.5; margin-top: 4px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Discount tag inside price */
.special-disc {
  display: inline-block;
  margin-left: 6px;
  padding: 2px 7px;
  background: var(--gold-bg);
  border: 1px solid rgba(168,113,40,0.2);
  border-radius: 6px;
  font-size: 0.6rem; font-weight: 700;
  color: var(--gold); letter-spacing: 0.04em;
  vertical-align: middle;
}

/* Secret skeleton card */
.skel-secret-card {
  display: flex;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 18px;
  overflow: hidden;
  margin-bottom: 10px;
}

.skel-secret-img {
  width: 100px; min-height: 90px; flex-shrink: 0;
  background: linear-gradient(90deg, var(--bg-2) 25%, var(--bg) 50%, var(--bg-2) 75%);
  background-size: 400% 100%;
  animation: shimmer 1.6s ease-in-out infinite;
}

.skel-secret-body {
  flex: 1; padding: 16px 18px;
}

/* Secret empty / error state */
.secret-empty {
  padding: 48px 20px;
  text-align: center;
  display: flex; flex-direction: column;
  align-items: center; gap: 8px;
}

/* Tomorrow footer note */
.tomorrow-footer {
  margin-top: 20px;
  font-size: 0.7rem; color: var(--ink-3);
  line-height: 1.6; text-align: center;
  padding: 16px;
  background: var(--bg-2);
  border: 1px dashed var(--border);
  border-radius: 14px;
}
.tomorrow-intro {
  display: flex; align-items: center; gap: 14px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 16px;
  padding: 16px 18px;
  margin-bottom: 16px;
}

.tomorrow-intro-icon { font-size: 1.6rem; }

.tomorrow-intro-title {
  font-size: 0.82rem; font-weight: 700;
  color: var(--ink); margin-bottom: 3px;
}

.tomorrow-intro-sub { font-size: 0.68rem; color: var(--ink-3); }

/* Tomorrow cards */
.tomorrow-card {
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: 16px;
  padding: 16px 18px;
  margin-bottom: 8px;
  display: flex; align-items: center; gap: 14px;
  transition: border-color 0.2s, transform 0.25s var(--spring);
}

.tomorrow-card:hover {
  border-color: var(--border-2);
  transform: translateX(3px);
}

.tomorrow-emoji {
  width: 46px; height: 46px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 13px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.3rem; flex-shrink: 0;
}

.tomorrow-info { flex: 1; }

.tomorrow-name {
  font-size: 0.88rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.01em;
  margin-bottom: 2px;
}

.tomorrow-kitchen {
  font-size: 0.64rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-3); margin-bottom: 3px;
}

.tomorrow-hint {
  font-size: 0.65rem; color: var(--ink-3);
}

.tomorrow-notify {
  display: flex; align-items: center; gap: 5px;
  padding: 8px 13px;
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: 0.62rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-2); cursor: pointer;
  flex-shrink: 0;
  transition: all 0.25s var(--spring);
  font-family: 'Sora', sans-serif;
}

.tomorrow-notify:hover {
  border-color: var(--green-bd);
  background: var(--green-bg);
  color: var(--green);
  transform: translateY(-1px);
}

.tomorrow-notify.notified {
  background: var(--green-bg);
  border-color: var(--green-bd);
  color: var(--green);
}

.tomorrow-footer {
  margin-top: 20px;
  font-size: 0.7rem; color: var(--ink-3);
  line-height: 1.6; text-align: center;
  padding: 16px;
  background: var(--bg-2);
  border: 1px dashed var(--border);
  border-radius: 14px;
}

/* Exclusive notice banner */
.exclusive-notice {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 14px;
  background: var(--ink);
  border-radius: 10px;
  font-size: 0.62rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: rgba(255,255,255,0.7);
  margin-bottom: 16px;
}

html.dark .exclusive-notice {
  background: var(--bg-2);
  border: 1px solid var(--border);
  color: var(--ink-3);
}

/* Sheet title sub */
.sheet-title-sub {
  font-size: 0.65rem; color: var(--ink-3);
  margin-top: 2px;
}

/* By Cuisine tab */
.cuisine-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 20px;
}

.cuisine-chip {
  padding: 14px 16px;
  background: var(--bg);
  border: 1.5px solid var(--border);
  border-radius: 16px;
  display: flex; align-items: center; gap: 10px;
  cursor: pointer;
  transition: all 0.25s var(--spring);
}

.cuisine-chip:hover, .cuisine-chip.active {
  background: var(--green-bg);
  border-color: var(--green-bd);
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.cuisine-emoji { font-size: 1.4rem; }

.cuisine-name {
  font-size: 0.78rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.01em;
  display: block; margin-bottom: 1px;
}

.cuisine-count { font-size: 0.62rem; color: var(--ink-3); }

</style>
</head>
<body>

<div class="scroll-bar" id="scrollBar"></div>

<div id="page-root">
  <nav class="navbar" id="navbar">
    <div class="nav-logo">
      <div class="nav-logo-dot"></div>
      Last Plate
    </div>
    <div class="nav-live">
      <div class="live-dot"></div>
      Live Rescue Feed
    </div>
    <div class="nav-right">
      <!-- Dark mode quick toggle in navbar -->
      <button class="icon-btn" id="navThemeBtn" aria-label="Toggle theme" title="Toggle dark mode">
        <svg class="moon-icon" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        <svg class="sun-icon"  width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      </button>
      <button class="icon-btn" id="openProfile" aria-label="Profile">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      </button>
    </div>
  </nav>

  <header class="hero">
    <div class="hero-kicker"><span></span>Premium Food Rescue</div>
    <h1 class="hero-h1">Good food shouldn't<br>go to <em>waste.</em></h1>
    <p class="hero-sub">Surplus meals from the finest kitchens near you ‚Äî rescued, discounted, ready to collect before they're gone.</p>
  </header>

  <div class="controls">
    <div class="search-row">
      <div class="search-box">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="foodSearch" placeholder="Search dishes or kitchens‚Ä¶" autocomplete="off">
      </div>
    </div>
    <div class="filter-scroll" id="locationRow">
      <div class="chip active" id="resetChip">All Kitchens</div>
    </div>
  </div>

  <div class="section-header">
    <span class="section-title">Available Now</span>
    <span class="plate-count" id="plateCount">‚Äî plates</span>
  </div>

  <div class="food-grid" id="foodGrid">
    <div class="skeleton-card"><div class="skel-img"></div><div class="skel-body"><div class="skel-line" style="width:40%;height:10px"></div><div class="skel-line" style="width:68%;height:20px"></div><div class="skel-line" style="width:50%;height:12px;margin-top:24px"></div></div></div>
    <div class="skeleton-card"><div class="skel-img"></div><div class="skel-body"><div class="skel-line" style="width:35%;height:10px"></div><div class="skel-line" style="width:75%;height:20px"></div><div class="skel-line" style="width:45%;height:12px;margin-top:24px"></div></div></div>
    <div class="skeleton-card"><div class="skel-img"></div><div class="skel-body"><div class="skel-line" style="width:50%;height:10px"></div><div class="skel-line" style="width:60%;height:20px"></div><div class="skel-line" style="width:55%;height:12px;margin-top:24px"></div></div></div>
  </div>

  <section class="support-section">
    <div class="support-card-wrap">
      <div>
        <h2 class="support-heading">Need help with<br>your <em>rescue?</em></h2>
        <p class="support-desc">Our team is here to make sure every mission runs smoothly. Reach out any time.</p>
        <div class="support-links">
          <a href="mailto:terminalplate@gmail.com" class="support-link">
            <div class="support-link-icon">‚úâÔ∏è</div>
            <div class="support-link-text">
              <span class="support-link-label">Email Support</span>
              <span class="support-link-value">terminalplate@gmail.com</span>
            </div>
          </a>
          <a href="https://instagram.com/a_7hul_" target="_blank" class="support-link">
            <div class="support-link-icon">üì∏</div>
            <div class="support-link-text">
              <span class="support-link-label">Instagram</span>
              <span class="support-link-value">@a_7hul_</span>
            </div>
          </a>
          <a href="tel:9633890173" class="support-link">
            <div class="support-link-icon">üìû</div>
            <div class="support-link-text">
              <span class="support-link-label">Help Hotline</span>
              <span class="support-link-value">+91 9633890173</span>
            </div>
          </a>
        </div>
      </div>
      <div class="support-decor">üçÉ</div>
    </div>
  </section>

  <footer>
    <div class="footer-left">
      <span class="footer-logo">Last Plate</span>
      <div class="footer-sep"></div>
      <span class="footer-copy">Est. 2024 ‚Äî Redefining the Surplus</span>
    </div>
    <a href="https://last-plate-knowmore.vercel.app/" class="footer-cta">Our Mission ‚Üí</a>
  </footer>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box" id="modalBox">
    <div class="modal-img-wrap">
      <img class="modal-img" id="modalImg" src="" alt="">
      <button class="modal-close" id="modalClose">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="modal-kicker" id="modalKicker"></div>
      <h2 class="modal-title" id="modalTitle"></h2>
      <p class="modal-restaurant" id="modalRestaurant"></p>
      <div class="modal-desc-box">Rescue mission active. Perfectly good food waiting for a home.</div>
      <div class="modal-footer">
        <div class="modal-price-block">
          <span class="modal-mrp" id="modalMrp"></span>
          <span class="modal-price" id="modalPrice"></span>
        </div>
        <a class="modal-cta" id="modalCta" href="#">Reserve Now ‚Üó</a>
      </div>
    </div>
  </div>
</div>

<!-- Profile Drawer -->
<div class="drawer-overlay" id="drawerOverlay">
  <div class="drawer-scrim" id="drawerScrim"></div>
  <div class="drawer-panel">
    <button class="drawer-back" id="closeProfile">‚Üê Back</button>
    <h2 class="drawer-title">Profile</h2>
    <div class="drawer-card">
      <div class="drawer-label">Rescue Agent</div>
      <div class="drawer-value" id="profileName">Syncing‚Ä¶</div>
    </div>
    <div class="drawer-row" style="margin-top:12px;">
      <span class="drawer-row-label">
        <svg class="theme-icon-moon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        <svg class="theme-icon-sun"  width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <span id="themeLabel">Dark Mode</span>
      </span>
      <div class="toggle" id="themeToggle"><div class="toggle-thumb"></div></div>
    </div>
    <div class="drawer-section-title">Rescue History</div>
    <div id="historyList"></div>
    <button class="drawer-logout" onclick="location.href='/logout'">Sign Out</button>
  </div>
</div>

<script>
/* ========================
   DARK MODE
======================== */
const html = document.documentElement;

function applyTheme(dark) {
  html.classList.toggle('dark', dark);
  // Sync both toggles
  document.getElementById('themeToggle').classList.toggle('on', dark);
  document.getElementById('themeLabel').textContent = dark ? 'Light Mode' : 'Dark Mode';
  try { localStorage.setItem('lp-theme', dark ? 'dark' : 'light'); } catch {}
}

// Load saved preference (or system preference)
(function initTheme() {
  let saved;
  try { saved = localStorage.getItem('lp-theme'); } catch {}
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  applyTheme(saved === 'dark' || (!saved && prefersDark));
})();

// Drawer toggle
document.getElementById('themeToggle').onclick = function() {
  applyTheme(!html.classList.contains('dark'));
  if (window.navigator.vibrate) window.navigator.vibrate(10);
};

// Navbar quick toggle
document.getElementById('navThemeBtn').onclick = function() {
  applyTheme(!html.classList.contains('dark'));
  if (window.navigator.vibrate) window.navigator.vibrate(10);
};

/* ========================
   SCROLL
======================== */
window.addEventListener('scroll', () => {
  const pct = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight);
  document.getElementById('scrollBar').style.width = (pct * 100) + '%';
  document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 20);
}, { passive: true });

/* ========================
   IMAGE MAP
======================== */
function getFoodImage(name) {
  const n = (name || '').toLowerCase();
  const map = [
    [['butter chicken', 'butter'], 'https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=800&q=80'],
    [['biriyani', 'biryani', 'briyani'], 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRPkrextD5AUzleyWSR6wLohiJc4HD6ronEyg&s'],
    [['mandhi', 'mandi'], 'https://images.unsplash.com/photo-1628294896516-344152572c7b?w=800&q=80'],
    [['chapati', 'chapatti', 'chappa'], 'https://images.unsplash.com/photo-1595295333158-4de421a3d3c4?w=800&q=80'],
    [['parotta', 'porotta'], 'https://images.unsplash.com/photo-1567188040759-fb8a883dc6d8?w=800&q=80'],
    [['alfaham', 'al fahm'], 'https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?w=800&q=80'],
    [['shawarma'], 'https://images.unsplash.com/photo-1561651188-d207bbec4ec3?w=800&q=80'],
    [['pizza'], 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&q=80'],
    [['burger'], 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=800&q=80'],
    [['rice', 'fried rice'], 'https://images.unsplash.com/photo-1516684732162-798a0062be99?w=800&q=80'],
    [['curry'], 'https://images.unsplash.com/photo-1585937421612-70a008356fbe?w=800&q=80'],
    [['noodle', 'noodles'], 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=800&q=80'],
    [['sandwich'], 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=800&q=80'],
    [['soup'], 'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=800&q=80'],
    [['cake', 'dessert', 'sweet'], 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=800&q=80'],
  ];
  for (const [keys, url] of map) {
    if (keys.some(k => n.includes(k))) return url;
  }
  return 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80';
}

/* ========================
   STATE
======================== */
let allFoods = [];
let currentLoc = 'all';

function discount(mrp, price) {
  if (!mrp || mrp <= price) return null;
  return Math.round(((mrp - price) / mrp) * 100);
}

/* ========================
   RENDER
======================== */
function render(foods) {
  const grid = document.getElementById('foodGrid');
  document.getElementById('plateCount').textContent = `${foods.length} plate${foods.length !== 1 ? 's' : ''}`;

  if (!foods.length) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üçÉ</div>
        <div class="empty-title">No plates available right now</div>
        <div class="empty-sub">Kitchens are preparing ‚Äî check back soon.</div>
      </div>`;
    return;
  }

  grid.innerHTML = foods.map((f, i) => {
    const disc = discount(f.mrp, f.price);
    const urgent = f.minutes_left <= 15;
    const safeF = encodeURIComponent(JSON.stringify(f));
    return `
    <article class="food-card" style="animation-delay:${i * 0.055}s" onclick="openModal(decodeURIComponent('${safeF}'))">
      <div class="card-img-wrap">
        <img class="card-img" src="${getFoodImage(f.name)}" alt="${f.name}" loading="lazy">
        <div class="card-badges">
          <span class="badge badge-qty">${f.available_quantity} left</span>
          <span class="badge badge-time${urgent ? ' urgent' : ''}">${f.minutes_left}m</span>
        </div>
        ${disc ? `<div class="discount-pill">${disc}% off</div>` : ''}
      </div>
      <div class="card-body">
        <div class="card-restaurant">${f.restaurant_name}</div>
        <div class="card-name">${f.name}</div>
        <div class="card-footer">
          <div class="price-group">
            ${f.mrp ? `<span class="price-mrp">‚Çπ${f.mrp}</span>` : ''}
            <span class="price-now">‚Çπ${Math.ceil(f.price)}</span>
          </div>
          <button class="card-reserve-btn">Reserve ‚Üó</button>
        </div>
      </div>
    </article>`;
  }).join('');
}

function applyFilters() {
  const q = document.getElementById('foodSearch').value.toLowerCase();
  const filtered = allFoods.filter(f => {
    const locOk = currentLoc === 'all' || f.restaurant_address === currentLoc;
    const qOk = (f.name||'').toLowerCase().includes(q) || (f.restaurant_name||'').toLowerCase().includes(q);
    return locOk && qOk;
  });
  render(filtered);
}

/* ========================
   MODAL
======================== */
function openModal(raw) {
  const f = JSON.parse(raw);
  document.getElementById('modalImg').src = getFoodImage(f.name);
  document.getElementById('modalKicker').textContent = `${f.available_quantity} plates  ‚Ä¢  ${f.minutes_left}m left`;
  document.getElementById('modalTitle').textContent = f.name;
  document.getElementById('modalRestaurant').textContent = 'üìç ' + f.restaurant_name;
  document.getElementById('modalMrp').textContent = f.mrp ? `MRP ‚Çπ${f.mrp}` : '';
  document.getElementById('modalPrice').textContent = '‚Çπ' + Math.ceil(f.price);
  document.getElementById('modalCta').href = `/checkout/${f.id}`;
  document.getElementById('modalOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
  if (window.navigator.vibrate) window.navigator.vibrate(8);
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

document.getElementById('modalClose').onclick = closeModal;
document.getElementById('modalOverlay').addEventListener('click', e => { if (e.target === e.currentTarget) closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeModal(); closeDrawer(); } });

/* ========================
   DRAWER
======================== */
function openDrawer() {
  document.getElementById('drawerOverlay').classList.add('open');
  document.body.classList.add('page-pushed');
  loadProfile();
}

function closeDrawer() {
  document.getElementById('drawerOverlay').classList.remove('open');
  document.body.classList.remove('page-pushed');
}

document.getElementById('openProfile').onclick = openDrawer;
document.getElementById('closeProfile').onclick = closeDrawer;
document.getElementById('drawerScrim').onclick = closeDrawer;

async function loadProfile() {
  try {
    const [uRes, oRes] = await Promise.all([
      fetch('/api/user/profile').catch(() => null),
      fetch('/api/user/orders').catch(() => null)
    ]);
    const u = uRes?.ok ? await uRes.json() : { name: 'Rescue Agent' };
    const orders = oRes?.ok ? await oRes.json() : [];
    document.getElementById('profileName').textContent = u.name || 'Agent';
    const hist = document.getElementById('historyList');
    hist.innerHTML = orders.length
      ? orders.map(o => `
          <div class="history-item">
            <div class="history-name">${o.food}</div>
            <div class="history-meta">‚Çπ${o.total_amount} ¬∑ ${o.status}</div>
          </div>`).join('')
      : `<p style="font-size:0.78rem;color:var(--ink-3);padding:12px 0">No rescue history yet.</p>`;
  } catch { document.getElementById('profileName').textContent = 'Guest'; }
}

/* ========================
   INIT
======================== */
document.getElementById('foodSearch').addEventListener('input', applyFilters);
document.getElementById('resetChip').onclick = () => {
  currentLoc = 'all';
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
  document.getElementById('resetChip').classList.add('active');
  applyFilters();
};

fetch('/api/foods')
  .then(r => { if (!r.ok) throw new Error(); return r.json(); })
  .then(data => {
    allFoods = data.foods || [];
    const locs = [...new Set(allFoods.map(f => f.restaurant_address).filter(Boolean))];
    const row = document.getElementById('locationRow');
    locs.forEach(loc => {
      const c = document.createElement('div');
      c.className = 'chip';
      c.textContent = loc;
      c.onclick = () => {
        currentLoc = loc;
        document.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
        c.classList.add('active');
        applyFilters();
      };
      row.appendChild(c);
    });
    applyFilters();
  })
  .catch(() => { allFoods = []; render([]); });

/* ========================
   BOTTOM NAV ACTIVE STATE
======================== */
function setActiveNav(id) {
  document.querySelectorAll('.bn-item').forEach(el => el.classList.remove('active'));
  const el = document.getElementById(id);
  if (el) el.classList.add('active');
}
setActiveNav('bnBrowse');

/* ========================
   SECRET MENU ‚Äî STATE
======================== */
let secretRestaurants = [];    // [{restaurant_id, restaurant_name, dish_count, min_price, max_price}]
let secretDishes = [];         // dishes for currently selected restaurant
let secretLoaded = false;

/* ========================
   SECRET MENU ‚Äî OPEN/CLOSE
======================== */
function openSecretMenu() {
  document.getElementById('secretSheet').classList.add('open');
  document.body.style.overflow = 'hidden';
  setActiveNav('bnSecret');
  if (window.navigator.vibrate) window.navigator.vibrate(12);
  if (!secretLoaded) loadSecretRestaurants();
}

function closeSecretMenu() {
  document.getElementById('secretSheet').classList.remove('open');
  document.body.style.overflow = '';
  setActiveNav('bnBrowse');
}

// Use event delegation ‚Äî works regardless of when elements are parsed
document.addEventListener('click', function(e) {
  if (e.target.id === 'secretScrim' || e.target.closest('#secretClose')) {
    closeSecretMenu();
  }
});

/* ========================
   SECRET MENU ‚Äî SEARCH
======================== */
// Cache: restaurant_id -> dishes array
const secretDishCache = {};

// After restaurants load, pre-fetch all dishes for search
async function prefetchAllDishes(restaurants) {
  await Promise.all(restaurants.map(async r => {
    if (secretDishCache[r.restaurant_id]) return;
    try {
      const res  = await fetch(`/api/secret-menu/${r.restaurant_id}`);
      const data = await res.json();
      secretDishCache[r.restaurant_id] = (data.dishes || []).map(d => ({
        ...d,
        restaurant_name: r.restaurant_name
      }));
    } catch { secretDishCache[r.restaurant_id] = []; }
  }));
}

function getAllCachedDishes() {
  return Object.values(secretDishCache).flat();
}

function handleSecretSearch(q) {
  const wrap    = document.getElementById('secretSearchWrap');
  const clearBtn = document.getElementById('secretSearchClear');
  const tabBody = document.querySelector('.sheet-body');
  q = q.trim().toLowerCase();

  clearBtn.style.display = q ? 'block' : 'none';

  // No query ‚Äî restore normal tab view
  if (!q) {
    document.getElementById('searchResultsPanel')?.remove();
    document.querySelectorAll('.tab-panel').forEach(p => p.style.display = '');
    return;
  }

  // Hide tab panels, show results panel instead
  document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');

  let panel = document.getElementById('searchResultsPanel');
  if (!panel) {
    panel = document.createElement('div');
    panel.id = 'searchResultsPanel';
    panel.className = 'search-results-panel tab-panel active';
    tabBody.appendChild(panel);
  }

  const all = getAllCachedDishes();
  const results = all.filter(d =>
    (d.name || '').toLowerCase().includes(q) ||
    (d.restaurant_name || '').toLowerCase().includes(q) ||
    (d.cuisine || '').toLowerCase().includes(q)
  );

  if (!results.length) {
    panel.innerHTML = `<div class="search-no-results">üçÉ No dishes found for "<strong>${q}</strong>"</div>`;
    return;
  }

  panel.innerHTML = results.map(d => `
    <a class="search-result-card" href="/checkout/secret/${d.id}">
      <img class="search-result-img"
           src="${d.img || getFoodImage(d.name)}"
           alt="${d.name}"
           onerror="this.src='https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=200&q=80'">
      <div class="search-result-info">
        <div class="search-result-name">${d.name}</div>
        <div class="search-result-kitchen">${d.restaurant_name}${d.cuisine ? ' ¬∑ ' + d.cuisine : ''}</div>
      </div>
      <div class="search-result-price">‚Çπ${Math.ceil(d.price)}</div>
    </a>
  `).join('');
}

// Wire up search input (after DOM ready)
document.addEventListener('DOMContentLoaded', () => {
  const input    = document.getElementById('secretSearch');
  const clearBtn = document.getElementById('secretSearchClear');
  if (!input) return;
  input.addEventListener('input', () => handleSecretSearch(input.value));
  clearBtn.onclick = () => {
    input.value = '';
    handleSecretSearch('');
    input.focus();
  };
});

/* ========================
   SECRET MENU ‚Äî TAB SWITCH
======================== */
document.querySelectorAll('.sheet-tab').forEach(tab => {
  tab.onclick = function() {
    const target = this.dataset.tab;
    document.querySelectorAll('.sheet-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById(target).classList.add('active');
  };
});

/* ========================
   SECRET MENU ‚Äî LOAD RESTAURANTS (Tab 1 sidebar)
======================== */
async function loadSecretRestaurants() {
  secretLoaded = true;
  const tabToday    = document.getElementById('tabToday');
  const tabTomorrow = document.getElementById('tabTomorrow');

  // Show skeletons in both tabs
  tabToday.innerHTML    = secretSkelList(3);
  tabTomorrow.innerHTML = secretSkelList(2);

  try {
    const res  = await fetch('/api/secret-menu/restaurants');
    const data = await res.json();
    secretRestaurants = data.restaurants || [];

    if (!secretRestaurants.length) {
      tabToday.innerHTML    = secretEmpty('No secret specials tonight.');
      tabTomorrow.innerHTML = secretEmpty('Nothing coming up yet ‚Äî check back later.');
      return;
    }

    // Pre-fetch all dishes in background so search works instantly
    prefetchAllDishes(secretRestaurants);

    // Tab 1: today's specials ‚Äî restaurants with is_today_special dishes
    renderSecretRestaurants(tabToday, secretRestaurants, 'today');
    // Tab 2: coming tomorrow ‚Äî all others (or same restaurants, chef's choice framing)
    renderSecretRestaurants(tabTomorrow, secretRestaurants, 'tomorrow');

    // Auto-load dishes for first restaurant in tab 1
    if (secretRestaurants[0]) {
      loadDishesForRestaurant(secretRestaurants[0], tabToday, 'today');
    }

  } catch (e) {
    tabToday.innerHTML    = secretError();
    tabTomorrow.innerHTML = secretError();
  }
}

/* ========================
   SECRET MENU ‚Äî RENDER RESTAURANT LIST
======================== */
function renderSecretRestaurants(container, restaurants, mode) {
  const notice = mode === 'today'
    ? `<div class="exclusive-notice"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Only available here ‚Äî not on the main browse</div>`
    : `<div class="tomorrow-intro"><div class="tomorrow-intro-icon">${mode === 'tomorrow' ? 'üåô' : 'üçΩÔ∏è'}</div><div><div class="tomorrow-intro-title">Tomorrow's drops are being prepped.</div><div class="tomorrow-intro-sub">Check back after 5 PM to see them unlock.</div></div></div>`;

  const restaurantBtns = restaurants.map((r, i) => `
    <button class="rest-chip ${i === 0 && mode === 'today' ? 'active' : ''}"
            onclick="loadDishesForRestaurant(${JSON.stringify(r).replace(/"/g, '&quot;')}, document.getElementById('${mode === 'today' ? 'tabToday' : 'tabTomorrow'}'), '${mode}', this)"
            data-rid="${r.restaurant_id}">
      <span class="rest-chip-name">${r.restaurant_name}</span>
      <span class="rest-chip-count">${r.dish_count} dish${r.dish_count !== 1 ? 'es' : ''}</span>
    </button>
  `).join('');

  container.innerHTML = `
    ${notice}
    <div class="rest-chip-row" id="restChips_${mode}">${restaurantBtns}</div>
    <div class="dishes-list" id="dishesList_${mode}">
      ${secretSkelList(2)}
    </div>
  `;
}

/* ========================
   SECRET MENU ‚Äî LOAD DISHES FOR A RESTAURANT
======================== */
async function loadDishesForRestaurant(restaurant, container, mode, chipEl) {
  // Update active chip
  const chipsContainer = document.getElementById(`restChips_${mode}`);
  if (chipsContainer) {
    chipsContainer.querySelectorAll('.rest-chip').forEach(c => c.classList.remove('active'));
    if (chipEl) chipEl.classList.add('active');
    else {
      const firstChip = chipsContainer.querySelector(`[data-rid="${restaurant.restaurant_id}"]`);
      if (firstChip) firstChip.classList.add('active');
    }
  }

  const dishesEl = document.getElementById(`dishesList_${mode}`);
  if (dishesEl) dishesEl.innerHTML = secretSkelList(2);

  try {
    const res  = await fetch(`/api/secret-menu/${restaurant.restaurant_id}`);
    const data = await res.json();
    const dishes = data.dishes || [];

    if (!dishes.length) {
      if (dishesEl) dishesEl.innerHTML = secretEmpty('No dishes available from this kitchen right now.');
      return;
    }

    if (dishesEl) {
      dishesEl.innerHTML = dishes.map(d => renderSecretDishCard(d, mode)).join('');
    }

  } catch (e) {
    if (dishesEl) dishesEl.innerHTML = secretError();
  }
}

/* ========================
   SECRET MENU ‚Äî DISH CARD TEMPLATE
======================== */
function renderSecretDishCard(d, mode) {
  const img = d.img || getFoodImage(d.name);
  const disc = d.mrp && d.mrp > d.price
    ? Math.round(((d.mrp - d.price) / d.mrp) * 100)
    : null;

  const tag = d.cuisine
    ? `<div class="special-tag">${cuisineEmoji(d.cuisine)} ${d.cuisine}</div>`
    : '';

  if (mode === 'tomorrow') {
    // Blurred teaser for "coming tomorrow"
    return `
      <div class="tomorrow-card">
        <div class="tomorrow-emoji">${cuisineEmoji(d.cuisine)}</div>
        <div class="tomorrow-info">
          <div class="tomorrow-name">${d.name}</div>
          <div class="tomorrow-kitchen">${d.restaurant_name || ''}</div>
          <div class="tomorrow-hint">üïï Available from tomorrow evening</div>
        </div>
        <button class="tomorrow-notify" onclick="notifyMe(this)">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          Notify
        </button>
      </div>`;
  }

  return `
    <div class="special-card" onclick="location.href='/checkout/secret/${d.id}'">
      <img class="special-img" src="${img}" alt="${d.name}" loading="lazy"
           onerror="this.src='https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400&q=80'">
      <div class="special-body">
        <div>
          ${tag}
          <div class="special-name">${d.name}</div>
          <div class="special-kitchen">${d.restaurant_name || ''} ¬∑ ${d.stock} left</div>
          ${d.description ? `<div class="special-desc">${d.description}</div>` : ''}
        </div>
        <div class="special-footer">
          <div class="special-price">
            ${d.mrp ? `<span class="mrp">‚Çπ${d.mrp}</span>` : ''}
            ‚Çπ${Math.ceil(d.price)}
            ${disc ? `<span class="special-disc">${disc}% off</span>` : ''}
          </div>
          <button class="special-btn" ${d.stock === 0 ? 'disabled style="opacity:0.5;cursor:not-allowed"' : ''}>
            ${d.stock === 0 ? 'Sold Out' : 'Reserve ‚Üó'}
          </button>
        </div>
      </div>
    </div>`;
}

/* ========================
   SECRET MENU ‚Äî HELPERS
======================== */
function cuisineEmoji(c) {
  if (!c) return 'üçΩÔ∏è';
  const map = { kerala:'ü••', arabic:'ü´ï', mughlai:'üçó', continental:'ü•ó',
                dessert:'üçÆ', chinese:'ü•¢', italian:'üçù', seafood:'üêü', biryani:'üçõ' };
  return map[(c || '').toLowerCase()] || 'üçΩÔ∏è';
}

function secretSkelList(n) {
  return Array.from({length: n}, () => `
    <div class="skel-secret-card">
      <div class="skel-secret-img"></div>
      <div class="skel-secret-body">
        <div class="skel-line" style="width:35%;height:9px"></div>
        <div class="skel-line" style="width:65%;height:16px"></div>
        <div class="skel-line" style="width:45%;height:10px;margin-top:18px"></div>
      </div>
    </div>`).join('');
}

function secretEmpty(msg) {
  return `<div class="secret-empty">
    <div style="font-size:2rem;margin-bottom:10px">üçÉ</div>
    <div style="font-size:0.78rem;color:var(--ink-3)">${msg}</div>
  </div>`;
}

function secretError() {
  return `<div class="secret-empty">
    <div style="font-size:2rem;margin-bottom:10px">‚ö†Ô∏è</div>
    <div style="font-size:0.78rem;color:var(--ink-3)">Couldn't load ‚Äî check your connection.</div>
  </div>`;
}

function notifyMe(btn) {
  btn.innerHTML = '‚úì Set!';
  btn.classList.add('notified');
  if (window.navigator.vibrate) window.navigator.vibrate(6);
}

// Drag to close sheet
let startY = 0;
const sheet = document.querySelector('.secret-sheet');
sheet.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, { passive: true });
sheet.addEventListener('touchend', e => {
  if (e.changedTouches[0].clientY - startY > 80) closeSecretMenu();
}, { passive: true });
</script>

<!-- ===================== BOTTOM NAV ===================== -->
<nav class="bottom-nav">
  <button class="bn-item active" id="bnBrowse" onclick="setActiveNav('bnBrowse'); window.scrollTo({top:0,behavior:'smooth'})">
    <div class="bn-icon">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </div>
    <span class="bn-label">Browse</span>
  </button>

  <button class="bn-item" id="bnSecret" onclick="openSecretMenu()">
    <div class="bn-icon">
      <!-- Fingerprint-style icon for "secret" -->
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><path d="M12 10a2 2 0 0 0-2 2v4"/><path d="M10 10a4 4 0 0 1 7.97.93"/><path d="M7.63 7.63A6 6 0 0 0 6 12c0 1.65.5 3.18 1.36 4.44"/><path d="M16 17a6 6 0 0 0 1.64-4"/><path d="M4.6 4.6A9 9 0 0 0 3 12c0 2.43.96 4.63 2.52 6.24"/><path d="M19.4 4.6A9 9 0 0 1 21 12c0 1.45-.34 2.82-.95 4.04"/></svg>
      <div class="bn-badge"></div>
    </div>
    <span class="bn-label">Chef's Secret</span>
  </button>
</nav>

<!-- ===================== CHEF'S SECRET MENU SHEET ===================== -->
<div class="secret-sheet-overlay" id="secretSheet">
  <div class="secret-scrim" id="secretScrim"></div>
  <div class="secret-sheet">
    <div class="sheet-handle"></div>

    <div class="sheet-header">
      <div class="sheet-title-row">
        <div class="sheet-title">
          <div class="sheet-title-icon">ü§´</div>
          <div>
            <div class="sheet-title-text">Chef's Secret Menu</div>
            <div class="sheet-title-sub">Exclusive dishes, not on the main feed</div>
          </div>
        </div>
        <button class="sheet-close" id="secretClose">‚úï</button>
      </div>

      <div class="sheet-tabs">
        <button class="sheet-tab active" data-tab="tabToday">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Tonight's Exclusives
        </button>
        <button class="sheet-tab" data-tab="tabTomorrow">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          Coming Tomorrow
        </button>
      </div>

      <!-- Search bar -->
      <div class="sheet-search-box" id="secretSearchWrap">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="secretSearch" placeholder="Search dish or kitchen‚Ä¶" autocomplete="off">
        <button class="sheet-search-clear" id="secretSearchClear" style="display:none">‚úï</button>
      </div>
    </div>

    <div class="sheet-body">
      <!-- TAB 1: TONIGHT'S EXCLUSIVES ‚Äî populated by JS -->
      <div class="tab-panel active" id="tabToday"></div>

      <!-- TAB 2: COMING TOMORROW ‚Äî populated by JS -->
      <div class="tab-panel" id="tabTomorrow"></div>
    </div><!-- /sheet-body -->
  </div><!-- /secret-sheet -->
</div><!-- /secret-sheet-overlay -->

<script>
function notifyMe(btn) {
  btn.innerHTML = '‚úì Set!';
  btn.classList.add('notified');
  if (window.navigator.vibrate) window.navigator.vibrate(6);
}
</script>

</body>
</html>
