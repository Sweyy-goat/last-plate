<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Savings | LastPlate</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">

<style>
:root {
  --white:    #FFFFFF;
  --bg:       #F7F6F2;
  --bg-2:     #EFEDE7;
  --border:   #E4E1D9;
  --border-2: #D0CCC2;
  --ink:      #1A1916;
  --ink-2:    #5C5950;
  --ink-3:    #9B978E;
  --green:    #3D7A2E;
  --green-l:  #4E9B3C;
  --green-bg: #EDF5EB;
  --green-bd: #C2DBBE;
  --gold:     #A87128;
  --gold-l:   #C48D3A;
  --gold-bg:  #FDF6EC;
  --gold-bd:  #E8D0A0;
  --red:      #C8391A;
  --red-bg:   #FDF0ED;
  --shadow-sm: 0 1px 3px rgba(26,25,22,0.06), 0 1px 2px rgba(26,25,22,0.04);
  --shadow-md: 0 4px 16px rgba(26,25,22,0.08), 0 2px 6px rgba(26,25,22,0.05);
  --shadow-lg: 0 16px 48px rgba(26,25,22,0.12), 0 4px 12px rgba(26,25,22,0.06);
  --shadow-xl: 0 32px 80px rgba(26,25,22,0.16);
  --spring: cubic-bezier(0.16, 1, 0.3, 1);
  --bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Sora', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* =====================
   NAVBAR
===================== */
.navbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 68px;
  padding: 0 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 1000;
  background: rgba(247,246,242,0.92);
  backdrop-filter: blur(20px);
  box-shadow: 0 1px 0 var(--border);
}

.nav-logo {
  display: flex; align-items: center; gap: 9px;
  font-size: 1.05rem; font-weight: 700;
  color: var(--ink); letter-spacing: -0.02em;
  text-decoration: none;
}

.nav-logo-dot {
  width: 8px; height: 8px;
  background: var(--green); border-radius: 50%;
  box-shadow: 0 0 0 3px rgba(61,122,46,0.15);
}

.nav-back {
  display: flex; align-items: center; gap: 8px;
  font-size: 0.72rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-3); text-decoration: none;
  transition: color 0.2s, gap 0.25s;
}

.nav-back:hover { color: var(--green); gap: 12px; }
.nav-back svg { transition: transform 0.25s var(--spring); }
.nav-back:hover svg { transform: translateX(-3px); }

/* =====================
   PAGE WRAPPER
===================== */
.page {
  max-width: 900px;
  margin: 0 auto;
  padding: 100px 40px 80px;
}

/* =====================
   PAGE HEADER
===================== */
.page-kicker {
  font-size: 0.65rem; font-weight: 700;
  letter-spacing: 0.14em; text-transform: uppercase;
  color: var(--green);
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 14px;
  opacity: 0;
  animation: riseIn 0.6s var(--spring) 0.05s forwards;
}

.page-kicker span { width: 18px; height: 1px; background: var(--green); display: inline-block; }

.page-title {
  font-family: 'Instrument Serif', serif;
  font-size: clamp(2.2rem, 5vw, 3.6rem);
  font-weight: 400;
  letter-spacing: -0.03em;
  line-height: 1.1;
  color: var(--ink);
  margin-bottom: 8px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.1s forwards;
}

.page-title em { font-style: italic; color: var(--green); }

.page-sub {
  font-size: 0.85rem; color: var(--ink-3);
  line-height: 1.7; margin-bottom: 48px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.18s forwards;
}

@keyframes riseIn {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: none; }
}

/* =====================
   HERO SAVINGS CARD
===================== */
.wallet-hero {
  position: relative;
  background: var(--ink);
  border-radius: 28px;
  padding: 48px 52px;
  overflow: hidden;
  margin-bottom: 20px;
  opacity: 0;
  animation: riseIn 0.8s var(--spring) 0.25s forwards;
}

/* Organic background blobs */
.wallet-hero::before {
  content: '';
  position: absolute;
  width: 400px; height: 400px;
  background: radial-gradient(circle, rgba(61,122,46,0.2) 0%, transparent 70%);
  top: -100px; right: -80px;
  border-radius: 50%;
  pointer-events: none;
}

.wallet-hero::after {
  content: '';
  position: absolute;
  width: 280px; height: 280px;
  background: radial-gradient(circle, rgba(168,113,40,0.15) 0%, transparent 70%);
  bottom: -60px; left: -40px;
  border-radius: 50%;
  pointer-events: none;
}

.wallet-hero-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 40px;
  position: relative; z-index: 2;
}

.wallet-chip {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 7px 14px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 100px;
  font-size: 0.62rem; font-weight: 600;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: rgba(255,255,255,0.6);
}

.wallet-chip-dot {
  width: 5px; height: 5px;
  background: var(--green-l); border-radius: 50%;
  box-shadow: 0 0 6px var(--green-l);
  animation: blink 2s ease infinite;
}

@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

.wallet-card-no {
  font-size: 0.6rem; font-weight: 600;
  letter-spacing: 0.2em; color: rgba(255,255,255,0.25);
}

.wallet-balance-label {
  font-size: 0.62rem; font-weight: 700;
  letter-spacing: 0.15em; text-transform: uppercase;
  color: rgba(255,255,255,0.4);
  margin-bottom: 10px;
  position: relative; z-index: 2;
}

.wallet-balance {
  font-family: 'Instrument Serif', serif;
  font-style: italic;
  font-size: clamp(3.5rem, 8vw, 6rem);
  font-weight: 400;
  letter-spacing: -0.03em;
  color: #fff;
  line-height: 1;
  margin-bottom: 32px;
  position: relative; z-index: 2;
}

.wallet-balance .currency {
  font-size: 0.45em;
  vertical-align: top;
  margin-top: 0.15em;
  color: rgba(255,255,255,0.5);
  font-family: 'Sora', sans-serif;
  font-style: normal;
  font-weight: 600;
}

.wallet-bottom {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  position: relative; z-index: 2;
  flex-wrap: wrap;
  gap: 20px;
}

.wallet-stat-row {
  display: flex; gap: 32px;
}

.wallet-stat {}

.wallet-stat-val {
  font-size: 1.2rem; font-weight: 700;
  color: #fff; letter-spacing: -0.02em;
  margin-bottom: 3px;
}

.wallet-stat-lbl {
  font-size: 0.6rem; font-weight: 600;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: rgba(255,255,255,0.35);
}

.wallet-cta-row {
  display: flex; gap: 10px;
}

.wallet-btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 12px 22px;
  border-radius: 14px;
  font-size: 0.72rem; font-weight: 700;
  letter-spacing: 0.04em;
  cursor: pointer; border: none;
  transition: all 0.3s var(--spring);
  text-decoration: none;
}

.wallet-btn-primary {
  background: var(--green-l); color: #fff;
}

.wallet-btn-primary:hover {
  background: #5CB348;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(78,155,60,0.4);
}

/* =====================
   TODAY BANNER
===================== */
.today-banner {
  background: var(--gold-bg);
  border: 1.5px solid var(--gold-bd);
  border-radius: 20px;
  padding: 22px 28px;
  display: flex;
  align-items: center;
  gap: 18px;
  margin-bottom: 32px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.35s forwards;
}

.today-icon {
  width: 48px; height: 48px;
  background: var(--white);
  border: 1.5px solid var(--gold-bd);
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.5rem; flex-shrink: 0;
}

.today-text {}

.today-main {
  font-family: 'Instrument Serif', serif;
  font-size: 1.3rem; font-weight: 400;
  letter-spacing: -0.02em; color: var(--ink);
  margin-bottom: 2px;
}

.today-main strong { color: var(--gold); }

.today-sub {
  font-size: 0.72rem; color: var(--ink-3); line-height: 1.5;
}

.today-badge {
  margin-left: auto; flex-shrink: 0;
  padding: 6px 14px;
  background: var(--gold);
  border-radius: 100px;
  font-size: 0.62rem; font-weight: 700;
  letter-spacing: 0.08em; text-transform: uppercase;
  color: #fff;
}

/* =====================
   TWO-COL LAYOUT
===================== */
.two-col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.42s forwards;
}

/* =====================
   STATS GRID
===================== */
.stat-card {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 22px;
  padding: 28px;
  box-shadow: var(--shadow-sm);
  transition: border-color 0.25s, box-shadow 0.3s var(--spring), transform 0.3s var(--spring);
}

.stat-card:hover {
  border-color: var(--border-2);
  box-shadow: var(--shadow-md);
  transform: translateY(-3px);
}

.stat-card-icon {
  width: 44px; height: 44px;
  border-radius: 13px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.25rem; margin-bottom: 20px;
}

.icon-green  { background: var(--green-bg); border: 1.5px solid var(--green-bd); }
.icon-gold   { background: var(--gold-bg);  border: 1.5px solid var(--gold-bd); }
.icon-red    { background: var(--red-bg);   border: 1.5px solid rgba(200,57,26,0.2); }
.icon-ink    { background: var(--bg-2);     border: 1.5px solid var(--border); }

.stat-card-val {
  font-family: 'Instrument Serif', serif;
  font-size: 2.4rem; font-weight: 400;
  letter-spacing: -0.03em; color: var(--ink);
  line-height: 1; margin-bottom: 5px;
}

.stat-card-label {
  font-size: 0.7rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  color: var(--ink-3);
}

/* =====================
   STREAK CARD
===================== */
.streak-card {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 22px;
  padding: 28px;
  box-shadow: var(--shadow-sm);
  grid-column: 1 / -1;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.48s forwards;
  transition: border-color 0.25s, box-shadow 0.3s var(--spring);
}

.streak-card:hover {
  border-color: var(--border-2);
  box-shadow: var(--shadow-md);
}

.streak-header {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.streak-title {
  font-family: 'Instrument Serif', serif;
  font-size: 1.4rem; font-weight: 400;
  letter-spacing: -0.02em; color: var(--ink);
}

.streak-badge {
  display: flex; align-items: center; gap: 7px;
  padding: 8px 16px;
  background: var(--gold-bg);
  border: 1.5px solid var(--gold-bd);
  border-radius: 100px;
  font-size: 0.68rem; font-weight: 700;
  color: var(--gold); letter-spacing: 0.04em;
}

/* Week dots */
.streak-dots {
  display: flex; gap: 8px; margin-bottom: 20px;
}

.streak-day {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; gap: 8px;
}

.streak-dot {
  width: 40px; height: 40px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg);
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
  transition: all 0.3s var(--bounce);
}

.streak-dot.done {
  background: var(--green-bg);
  border-color: var(--green-bd);
}

.streak-dot.today {
  background: var(--green);
  border-color: var(--green);
  box-shadow: 0 0 0 4px rgba(61,122,46,0.15);
  transform: scale(1.12);
}

.streak-dot.today span { filter: brightness(10); }

.streak-day-label {
  font-size: 0.58rem; font-weight: 700;
  letter-spacing: 0.08em; text-transform: uppercase;
  color: var(--ink-3);
}

.streak-day-label.today-lbl { color: var(--green); }

.streak-sub {
  font-size: 0.75rem; color: var(--ink-3); line-height: 1.6;
}

.streak-sub strong { color: var(--green); font-weight: 700; }

/* =====================
   MILESTONES
===================== */
.milestones-section {
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.54s forwards;
  margin-bottom: 20px;
}

.section-label {
  font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.12em; text-transform: uppercase;
  color: var(--ink-3); margin-bottom: 14px;
  display: flex; align-items: center; gap: 10px;
}

.section-label::after {
  content: '';
  flex: 1; height: 1px;
  background: var(--border);
}

.milestone-list {
  display: flex; flex-direction: column; gap: 10px;
}

.milestone {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 18px;
  padding: 20px 24px;
  display: flex; align-items: center; gap: 18px;
  box-shadow: var(--shadow-sm);
  transition: all 0.3s var(--spring);
}

.milestone:hover {
  border-color: var(--border-2);
  box-shadow: var(--shadow-md);
  transform: translateX(4px);
}

.milestone.unlocked {
  background: var(--green-bg);
  border-color: var(--green-bd);
}

.milestone.unlocked:hover { border-color: var(--green); }

.milestone-icon {
  width: 48px; height: 48px; flex-shrink: 0;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem;
}

.milestone.unlocked .milestone-icon {
  background: var(--white);
  border-color: var(--green-bd);
}

.milestone-text { flex: 1; }

.milestone-name {
  font-size: 0.88rem; font-weight: 700;
  color: var(--ink); margin-bottom: 3px;
  letter-spacing: -0.01em;
}

.milestone-desc {
  font-size: 0.7rem; color: var(--ink-3); line-height: 1.5;
}

.milestone-right { text-align: right; flex-shrink: 0; }

.milestone-reward {
  font-size: 0.82rem; font-weight: 700;
  color: var(--green); letter-spacing: -0.01em;
  margin-bottom: 6px;
  display: block;
}

/* Progress bar */
.milestone-progress-wrap {
  width: 100px; height: 5px;
  background: var(--border);
  border-radius: 3px; overflow: hidden;
}

.milestone-progress-fill {
  height: 100%;
  background: var(--green);
  border-radius: 3px;
  transition: width 1.2s var(--spring);
}

.milestone.unlocked .milestone-progress-fill { background: var(--green-l); }

.milestone-lock {
  width: 28px; height: 28px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  color: var(--ink-3);
}

.milestone.unlocked .milestone-lock {
  background: var(--green);
  border-color: var(--green);
  color: #fff;
}

/* =====================
   TRANSACTION HISTORY
===================== */
.history-section {
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.6s forwards;
}

.tx-list { display: flex; flex-direction: column; gap: 8px; }

.tx-item {
  background: var(--white);
  border: 1.5px solid var(--border);
  border-radius: 16px;
  padding: 18px 22px;
  display: flex; align-items: center; gap: 16px;
  box-shadow: var(--shadow-sm);
  transition: border-color 0.2s, transform 0.3s var(--spring);
}

.tx-item:hover {
  border-color: var(--border-2);
  transform: translateX(3px);
}

.tx-icon {
  width: 42px; height: 42px; flex-shrink: 0;
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem;
}

.tx-icon.credit { background: var(--green-bg); border: 1.5px solid var(--green-bd); }
.tx-icon.debit  { background: var(--red-bg); border: 1.5px solid rgba(200,57,26,0.2); }
.tx-icon.bonus  { background: var(--gold-bg); border: 1.5px solid var(--gold-bd); }

.tx-info { flex: 1; }

.tx-name {
  font-size: 0.85rem; font-weight: 600;
  color: var(--ink); margin-bottom: 2px;
}

.tx-meta {
  font-size: 0.68rem; color: var(--ink-3);
  display: flex; align-items: center; gap: 6px;
}

.tx-dot {
  width: 3px; height: 3px;
  background: var(--border-2); border-radius: 50%;
}

.tx-amount {
  font-size: 1.05rem; font-weight: 700;
  letter-spacing: -0.02em;
}

.tx-amount.credit { color: var(--green); }
.tx-amount.debit  { color: var(--red); }
.tx-amount.bonus  { color: var(--gold); }

/* =====================
   REFERRAL CARD
===================== */
.referral-card {
  background: var(--ink);
  border-radius: 22px;
  padding: 36px 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 32px;
  margin-top: 20px;
  opacity: 0;
  animation: riseIn 0.7s var(--spring) 0.66s forwards;
  overflow: hidden;
  position: relative;
}

.referral-card::before {
  content: '';
  position: absolute;
  width: 300px; height: 300px;
  background: radial-gradient(circle, rgba(78,155,60,0.15) 0%, transparent 70%);
  top: -80px; right: 80px;
  border-radius: 50%;
  pointer-events: none;
}

.referral-text {}

.referral-eyebrow {
  font-size: 0.6rem; font-weight: 700;
  letter-spacing: 0.15em; text-transform: uppercase;
  color: rgba(255,255,255,0.35); margin-bottom: 8px;
}

.referral-title {
  font-family: 'Instrument Serif', serif;
  font-size: 1.8rem; font-weight: 400;
  letter-spacing: -0.02em; color: #fff;
  line-height: 1.15; margin-bottom: 8px;
}

.referral-title em { font-style: italic; color: var(--green-l); }

.referral-sub {
  font-size: 0.75rem; color: rgba(255,255,255,0.45);
  line-height: 1.6; max-width: 320px;
}

.referral-box {
  flex-shrink: 0; display: flex; flex-direction: column; gap: 12px;
  position: relative; z-index: 1;
}

.referral-code-wrap {
  display: flex; align-items: center; gap: 0;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 14px; overflow: hidden;
}

.referral-code {
  padding: 13px 18px;
  font-size: 0.88rem; font-weight: 700;
  letter-spacing: 0.12em; color: #fff;
  font-family: 'Sora', monospace;
}

.referral-copy {
  padding: 13px 18px;
  background: rgba(255,255,255,0.08);
  border: none; border-left: 1px solid rgba(255,255,255,0.1);
  color: rgba(255,255,255,0.6);
  cursor: pointer; font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.08em; text-transform: uppercase;
  transition: all 0.2s; font-family: 'Sora', sans-serif;
}

.referral-copy:hover { background: rgba(255,255,255,0.14); color: #fff; }
.referral-copy.copied { color: var(--green-l); }

.referral-share {
  display: flex; align-items: center; justify-content: center; gap: 7px;
  padding: 13px 22px;
  background: var(--green-l); color: #fff;
  border: none; border-radius: 14px;
  font-size: 0.72rem; font-weight: 700;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: all 0.3s var(--spring);
  font-family: 'Sora', sans-serif;
}

.referral-share:hover {
  background: #5CB348;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(78,155,60,0.4);
}

/* =====================
   RESPONSIVE
===================== */
@media (max-width: 760px) {
  .navbar { padding: 0 20px; }
  .page { padding: 90px 20px 60px; }
  .wallet-hero { padding: 32px 28px; }
  .wallet-bottom { flex-direction: column; align-items: flex-start; }
  .two-col { grid-template-columns: 1fr 1fr; }
  .referral-card { flex-direction: column; padding: 28px 24px; }
  .referral-box { width: 100%; }
  .referral-code-wrap { width: 100%; }
}

@media (max-width: 480px) {
  .two-col { grid-template-columns: 1fr; }
  .streak-dot { width: 34px; height: 34px; font-size: 0.85rem; }
  .today-banner { flex-wrap: wrap; }
  .today-badge { margin-left: 0; }
}

/* =====================
   TOAST
===================== */
.toast {
  position: fixed; bottom: 28px; left: 50%;
  transform: translateX(-50%) translateY(20px);
  padding: 11px 20px;
  background: var(--ink); color: var(--bg);
  border-radius: 12px;
  font-size: 0.75rem; font-weight: 600;
  box-shadow: var(--shadow-lg);
  z-index: 9999; opacity: 0;
  transition: all 0.35s var(--spring);
  white-space: nowrap;
}

.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<nav class="navbar">
  <a href="/browse" class="nav-back">
    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    Browse
  </a>
  <a href="/browse" class="nav-logo">
    <div class="nav-logo-dot"></div>
    LastPlate
  </a>
  <div style="width:80px"></div></nav>

<div class="page">

  <div class="page-kicker"><span></span>Your Impact</div>
  <h1 class="page-title">Rescue &<br><em>savings.</em></h1>
  <p class="page-sub">Every plate you rescue boosts your savings and builds your streak. Keep going ‚Äî the Earth thanks you.</p>

  <div class="wallet-hero">
    <div class="wallet-hero-top">
      <div class="wallet-chip">
        <div class="wallet-chip-dot"></div>
        Active Savings
      </div>
      <div class="wallet-card-no">**** **** 7713</div>
    </div>

    <div class="wallet-balance-label">Total Money Saved</div>
    <div class="wallet-balance" id="walletBalance">
      <span class="currency">‚Çπ</span><span id="balanceNum">0</span>
    </div>

    <div class="wallet-bottom">
      <div class="wallet-stat-row">
        <div class="wallet-stat">
          <div class="wallet-stat-val" id="statSaved">‚Çπ0</div>
          <div class="wallet-stat-lbl">Saved Today</div>
        </div>
        <div class="wallet-stat">
          <div class="wallet-stat-val" id="statTotal">‚Çπ0</div>
          <div class="wallet-stat-lbl">Total Saved</div>
        </div>
        <div class="wallet-stat">
          <div class="wallet-stat-val" id="statMeals">0</div>
          <div class="wallet-stat-lbl">Meals Rescued</div>
        </div>
      </div>
      <div class="wallet-cta-row">
        <a href="/browse" class="wallet-btn wallet-btn-primary">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
          Rescue a Plate
        </a>
      </div>
    </div>
  </div>

  <div class="today-banner" id="todayBanner">
    <div class="today-icon">üåø</div>
    <div class="today-text">
      <div class="today-main">You saved <strong id="todaySavingDisplay">‚Çπ0</strong> today!</div>
      <div class="today-sub">Amazing ‚Äî that's <span id="co2Saved">0g</span> of CO‚ÇÇ prevented and <span id="waterSaved">0L</span> of water saved.</div>
    </div>
    <div class="today-badge" id="todayBadge">Today</div>
  </div>

  <div class="two-col">
    <div class="stat-card">
      <div class="stat-card-icon icon-green">ü•ó</div>
      <div class="stat-card-val" id="statKg">0 kg</div>
      <div class="stat-card-label">Food Rescued</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon icon-gold">‚ö°</div>
      <div class="stat-card-val" id="statStreak">0</div>
      <div class="stat-card-label">Day Streak</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon icon-red">‚ôªÔ∏è</div>
      <div class="stat-card-val" id="statCo2">0 kg</div>
      <div class="stat-card-label">CO‚ÇÇ Prevented</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon icon-ink">üèÜ</div>
      <div class="stat-card-val" id="statRank">#‚Äî</div>
      <div class="stat-card-label">City Rank</div>
    </div>
  </div>

  <div class="streak-card">
    <div class="streak-header">
      <div class="streak-title">This Week's Streak</div>
      <div class="streak-badge">üî• <span id="streakCount">0</span> days</div>
    </div>
    <div class="streak-dots" id="streakDots">
      </div>
    <div class="streak-sub" id="streakSub">
      Keep rescuing to build your streak!
    </div>
  </div>

  <div class="milestones-section">
    <div class="section-label">Milestones</div>
    <div class="milestone-list" id="milestoneList">
      </div>
  </div>

  <div class="history-section">
    <div class="section-label">Rescue History</div>
    <div class="tx-list" id="txList">
      </div>
  </div>

  <div class="referral-card">
    <div class="referral-text">
      <div class="referral-eyebrow">Refer & Save</div>
      <div class="referral-title">Give ‚Çπ50,<br>Get <em>‚Çπ50</em> off.</div>
      <div class="referral-sub">Share your code with a friend. When they make their first rescue, you both get a ‚Çπ50 discount on your next rescue.</div>
    </div>
    <div class="referral-box">
      <div class="referral-code-wrap">
        <div class="referral-code" id="referralCode">RESCUE50</div>
        <button class="referral-copy" id="copyBtn" onclick="copyCode()">Copy</button>
      </div>
      <button class="referral-share" onclick="shareCode()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share with Friends
      </button>
    </div>
  </div>

</div><div class="toast" id="toast"></div>

<script>
/* ========================
   TOAST NOTIFICATION
======================== */
let toastT;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastT);
  toastT = setTimeout(() => t.classList.remove('show'), 2800);
}

/* ========================
   ANIMATED COUNTER
======================== */
function countUp(el, target, prefix = '', suffix = '', duration = 1600) {
  const start = Date.now();
  (function tick() {
    const p = Math.min((Date.now() - start) / duration, 1);
    const eased = 1 - Math.pow(1 - p, 3);
    const val = Math.floor(target * eased);
    el.textContent = prefix + val.toLocaleString() + suffix;
    if (p < 1) requestAnimationFrame(tick);
  })();
}

/* ========================
   FETCH FROM DATABASE API
======================== */
async function loadDashboardData() {
  try {
    const res = await fetch('/api/savings'); 
    
    if (!res.ok) {
        throw new Error('Failed to fetch data');
    }
    
    const data = await res.json();
    renderDashboard(data);

  } catch (error) {
    console.error("Error loading savings data:", error);
    showToast("Could not load your savings data.");
  }
}

/* ========================
   RENDER UI WITH DB DATA
======================== */
function renderDashboard(data) {
  // 1. Core Savings
  countUp(document.getElementById('balanceNum'), data.total_saved || 0, '', '', 1800);
  
  setTimeout(() => {
    countUp(document.getElementById('statSaved'), data.saved_today || 0, '‚Çπ', '', 1200);
    countUp(document.getElementById('statTotal'), data.total_saved || 0, '‚Çπ', '', 1500);
    countUp(document.getElementById('statMeals'), data.meals_rescued || 0, '', '', 1200);
  }, 300);

  // 2. Today Banner
  document.getElementById('todaySavingDisplay').textContent = '‚Çπ' + (data.saved_today || 0);
  document.getElementById('co2Saved').textContent = ((data.saved_today || 0) * 0.6).toFixed(0) + 'g';
  document.getElementById('waterSaved').textContent = ((data.saved_today || 0) * 1.2).toFixed(0) + 'L';

  // 3. Stats Grid
  setTimeout(() => {
    countUp(document.getElementById('statKg'), data.food_kg || 0, '', ' kg', 1400);
    countUp(document.getElementById('statStreak'), data.streak || 0, '', '', 1000);
    countUp(document.getElementById('statCo2'), data.co2_kg || 0, '', ' kg', 1400);
    document.getElementById('statRank').textContent = '#' + (data.city_rank || '‚Äî');
  }, 400);

  // 4. Streak Logic
  const streakEl = document.getElementById('streakDots');
  document.getElementById('streakCount').textContent = data.streak || 0;
  
  if (data.week_days && Array.isArray(data.week_days)) {
      streakEl.innerHTML = data.week_days.map(d => `
        <div class="streak-day">
          <div class="streak-dot ${d.done ? 'done' : ''} ${d.today ? 'today' : ''}">
            <span>${d.done ? '‚úì' : (d.today ? '‚óè' : '')}</span>
          </div>
          <div class="streak-day-label ${d.today ? 'today-lbl' : ''}">${d.day}</div>
        </div>
      `).join('');
  }

  // 5. Milestones
  if (data.milestones && Array.isArray(data.milestones)) {
      document.getElementById('milestoneList').innerHTML = data.milestones.map(m => `
        <div class="milestone ${m.unlocked ? 'unlocked' : ''}">
          <div class="milestone-icon">${m.icon}</div>
          <div class="milestone-text">
            <div class="milestone-name">${m.name}</div>
            <div class="milestone-desc">${m.desc}</div>
          </div>
          <div class="milestone-right">
            <span class="milestone-reward">${m.reward}</span>
            ${m.unlocked
              ? `<div class="milestone-lock">
                   <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                 </div>`
              : `<div class="milestone-progress-wrap">
                   <div class="milestone-progress-fill" data-w="${m.progress}" style="width:0%"></div>
                 </div>`
            }
          </div>
        </div>
      `).join('');

      setTimeout(() => {
        document.querySelectorAll('.milestone-progress-fill').forEach(el => {
          el.style.width = el.dataset.w + '%';
        });
      }, 600);
  }

  // 6. Transactions / History
  if (data.transactions && Array.isArray(data.transactions)) {
      document.getElementById('txList').innerHTML = data.transactions.map(tx => `
        <div class="tx-item">
          <div class="tx-icon ${tx.type}">${tx.icon}</div>
          <div class="tx-info">
            <div class="tx-name">${tx.name}</div>
            <div class="tx-meta">
              ${tx.place}
              <div class="tx-dot"></div>
              ${tx.time}
            </div>
          </div>
          <div class="tx-amount ${tx.type}">${tx.amount}</div>
        </div>
      `).join('');
  }

  // 7. Referral Code
  document.getElementById('referralCode').textContent = data.referral_code || 'RESCUE50';
}

/* ========================
   REFERRAL ACTIONS
======================== */
function copyCode() {
  const code = document.getElementById('referralCode').textContent;
  navigator.clipboard.writeText(code).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    showToast('Code copied to clipboard!');
    setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
  });
}

function shareCode() {
  const code = document.getElementById('referralCode').textContent;
  if (navigator.share) {
    navigator.share({
      title: 'Join LastPlate!',
      text: `Use my code ${code} to get ‚Çπ50 off your first rescue on LastPlate üåø`,
      url: 'https://www.lastplate.in/signup?ref=' + code
    });
  } else {
    copyCode();
  }
}

/* ========================
   BOOT
======================== */
window.addEventListener('DOMContentLoaded', loadDashboardData);
</script>
</body>
</html>
