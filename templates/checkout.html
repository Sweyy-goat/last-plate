<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Secure Checkout | Last Plate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
:root{
  --bg:#05070c;
  --card:#0f172a;
  --glass:rgba(255,255,255,.06);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --glow:rgba(34,197,94,.45);
}

*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,sans-serif}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at top,#0b1220,#020617 55%),
    linear-gradient(180deg,#020617,#000);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
}

.card{
  width:420px;
  max-width:94%;
  padding:26px;
  border-radius:22px;
  background:linear-gradient(180deg,var(--card),#020617);
  box-shadow:
    0 40px 90px rgba(0,0,0,.7),
    inset 0 0 0 1px rgba(255,255,255,.04);
  position:relative;
  overflow:hidden;
}

/* ðŸ”¥ GLOW LAYER (VISUAL ONLY) */
.card::before{
  content:"";
  position:absolute;
  inset:-60%;
  background:radial-gradient(circle,var(--glow),transparent 60%);
  opacity:.25;
  animation:pulse 8s infinite linear;
  pointer-events:none;   /* âœ… CRITICAL FIX */
  z-index:0;              /* âœ… stay behind */
}

/* ðŸ”’ PUSH ALL CONTENT ABOVE GLOW */
.card > *{
  position:relative;
  z-index:1;
}


@keyframes pulse{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}

.brand{
  text-align:center;
  position:relative;
  z-index:1;
}

.brand h1{
  margin:0;
  font-size:24px;
  letter-spacing:.4px;
}

.brand p{
  margin:6px 0 0;
  font-size:14px;
  color:var(--muted);
}

.hero{
  margin:22px 0;
  height:150px;
  border-radius:16px;
  background:
    linear-gradient(120deg,rgba(0,0,0,.6),rgba(0,0,0,.1)),
    url("https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&w=800&q=80");
  background-size:cover;
  background-position:center;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}

.food{
  background:var(--glass);
  border-radius:16px;
  padding:16px;
  backdrop-filter:blur(12px);
}

.food h2{
  margin:0;
  font-size:18px;
}

.food p{
  margin:4px 0;
  font-size:14px;
  color:var(--muted);
}

.price{
  margin-top:8px;
  font-weight:700;
  font-size:16px;
  color:#bbf7d0;
}

label{
  display:block;
  margin-top:18px;
  font-size:13px;
  color:var(--muted);
}

input{
  width:100%;
  margin-top:6px;
  padding:14px;
  border-radius:14px;
  border:none;
  background:#020617;
  color:var(--text);
  font-size:15px;
  outline:none;
  transition:box-shadow .2s;
}

input:focus{
  box-shadow:0 0 0 2px var(--glow);
}

button{
  width:100%;
  margin-top:24px;
  padding:16px;
  border-radius:16px;
  border:none;
  font-size:16px;
  font-weight:800;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#022c22;
  cursor:pointer;
  transition:transform .12s ease,box-shadow .12s ease,opacity .12s;
  box-shadow:0 12px 30px rgba(34,197,94,.45);
}

button:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 16px 40px rgba(34,197,94,.6);
}

button:disabled{
  opacity:.65;
  cursor:not-allowed;
}

.secure{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  color:var(--muted);
}

.footer{
  margin-top:10px;
  text-align:center;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="card">

  <div class="brand">
    <h1>Last Plate</h1>
    <p>Reserve surplus food â€¢ Save money â€¢ Reduce waste</p>
  </div>

  <div class="hero"></div>

  <div class="food">
    <h2>{{ food.name }}</h2>
    <p>{{ food.restaurant_name }}</p>
    <div class="price">â‚¹{{ food.price }} per item</div>
  </div>

  <label>Email for pickup OTP</label>
  <input id="email" type="email" placeholder="you@example.com" required>

  <label>Quantity</label>
  <input id="qty" type="number" min="1" max="{{ food.available_quantity }}" value="1">

  <button id="payBtn">Pay & Reserve Securely</button>

  <div class="secure">ðŸ”’ Powered by Razorpay â€¢ 100% Secure Payments</div>
  <div class="footer">Pickup OTP will be emailed after successful payment</div>

</div>

<script>
document.getElementById("payBtn").onclick=function(){
  const email=document.getElementById("email").value.trim();
  const qty=parseInt(document.getElementById("qty").value);
  const btn=this;

  if(!email) return alert("Please enter your email");
  if(!qty||qty<=0) return alert("Invalid quantity");

  btn.disabled=true;
  btn.innerText="Processing secure payment...";

  fetch("/api/create-order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      food_id:{{ food.id | tojson }},
      quantity:qty,
      email:email
    })
  })
  .then(r=>r.json())
  .then(d=>{
    const options={
      key:d.key,
      amount:d.amount,
      currency:"INR",
      order_id:d.razorpay_order_id,
      name:"Last Plate",
      description:"Food Reservation",
      handler:function(res){
        fetch("/api/verify-payment",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(res)
        })
        .then(r=>r.json())
        .then(out=>{
          if(out.success){
            alert("Reservation confirmed!\nBest regards \n Kindly note that the OTP has been dispatched to the respective registered email addresses." );
            setTimeout(()=>location.href="/browse",1600);
          }else{
            alert("Payment verification failed");
            btn.disabled=false;
            btn.innerText="Pay & Reserve Securely";
          }
        });
      },
      modal:{ondismiss:function(){
        btn.disabled=false;
        btn.innerText="Pay & Reserve Securely";
      }},
      theme:{color:"#22c55e"}
    };
    new Razorpay(options).open();
  })
  .catch(()=>{
    alert("Something went wrong");
    btn.disabled=false;
    btn.innerText="Pay & Reserve Securely";
  });
};
</script>

</body>
</html>
