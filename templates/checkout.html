<!DOCTYPE html>
<html>
<head>
  <title>Checkout | Last Plate</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <style>
    body {
      background:#0b0f14;
      color:#e5e7eb;
      font-family: Inter, system-ui;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }
    .box {
      background:#111827;
      padding:30px;
      border-radius:16px;
      width:360px;
    }
    h2 { margin-top:0 }
    input, button {
      width:100%;
      padding:12px;
      margin-top:10px;
      border-radius:10px;
      border:none;
    }
    button {
      background:#22c55e;
      font-weight:700;
      cursor:pointer;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>{{ food.name }}</h2>
  <p>{{ food.restaurant_name }}</p>
  <p>â‚¹{{ food.price }} each</p>

  <input type="number" id="qty" min="1" max="{{ food.available_quantity }}" value="1">

  <button onclick="pay()">Pay Now</button>
</div>

<script>
function pay() {
  const qty = document.getElementById("qty").value;

  fetch("/api/create-order", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      food_id: {{ food.id }},
      quantity: qty
    })
  })
  .then(res => res.json())
  .then(data => {
    const options = {
      key: data.key,
      amount: data.amount,
      currency: "INR",
      name: "Last Plate",
      description: "Food Reservation",
      order_id: data.razorpay_order_id,
      handler: function (response) {
        fetch("/api/verify-payment", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify(response)
        }).then(() => {
          alert("Payment successful ðŸŽ‰");
        });
      }
    };
    new Razorpay(options).open();
  });
}
</script>

</body>
</html>
